bettercms.define("bcms.newsletter",["bcms.jquery","bcms","bcms.siteSettings","bcms.dynamicContent","bcms.ko.extenders","bcms.ko.grid","bcms.antiXss"],function(a,c,m,d,g,h,b){var j={},l={downloadSubscribersInCsv:"#download-subscribers-in-csv",siteSettingsButtonOpener:".bcms-btn-opener",siteSettingsButtonHolder:".bcms-btn-opener-holder"},i={loadSiteSettingsSubscribersUrl:null,loadSubscribersUrl:null,saveSubscriberUrl:null,deleteSubscriberUrl:null,downoadCsvUrl:null},e={deleteSubscriberDialogTitle:null},k=0;j.links=i;j.globalization=e;j.selectors=l;var n=(function(p){c.extendsClass(q,p);function q(r,t,s){p.call(this,r,i.loadSubscribersUrl,t,s);}q.prototype.createItem=function(r){var s=new o(this,r);return s;};return q;})(h.ListViewModel);var o=(function(p){c.extendsClass(q,p);function q(s,r){p.call(this,s,r);var t=this;t.email=g.observable().extend({required:"",email:"",maxLength:{maxLength:g.maxLength.email}});t.registerFields(t.email);t.email(r.Email);}q.prototype.getDeleteConfirmationMessage=function(){return a.format(e.deleteSubscriberDialogTitle,b.encodeHtml(this.email()));};q.prototype.getSaveParams=function(){var r=p.prototype.getSaveParams.call(this);r.Email=this.email();return r;};q.prototype.getRowId=function(){if(!this.rowId){this.rowId="bcms-subscriber-row-"+k++;}return this.rowId;};return q;})(h.ItemViewModel);function f(t){var p=m.getMainContainer(),q=(t.Success==true)?t.Data:{},s=p.find(l.siteSettingsButtonHolder);var u=new n(p,q.Items,q.GridOptions);u.deleteUrl=i.deleteSubscriberUrl;u.saveUrl=i.saveSubscriberUrl;g.cleanNode(p.get(0));g.applyBindings(u,p.get(0));var r=p.find("input[type=text],textarea,select").filter(":visible:first");if(r){r.focus();}a(p.find(l.downloadSubscribersInCsv)).on("click",function(){window.location.href=i.downoadCsvUrl;});p.find(l.siteSettingsButtonOpener).on("click",function(v){c.stopEventPropagation(v);if(!s.hasClass("bcms-opened")){s.addClass("bcms-opened");}else{s.removeClass("bcms-opened");}});c.on(c.events.bodyClick,function(v){if(s.hasClass("bcms-opened")){s.removeClass("bcms-opened");}});}j.loadSiteSettingsNewsletterSubscribers=function(){d.bindSiteSettings(m,i.loadSiteSettingsSubscribersUrl,{contentAvailable:f});};j.init=function(){c.logger.debug("Initializing bcms.newsletter module.");};c.registerInit(j.init);return j;});