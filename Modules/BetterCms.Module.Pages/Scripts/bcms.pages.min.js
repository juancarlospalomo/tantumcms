bettercms.define("bcms.pages.content",["bcms.jquery","bcms","bcms.modal","bcms.content","bcms.pages.widgets","bcms.datepicker","bcms.htmlEditor","bcms.dynamicContent","bcms.siteSettings","bcms.messages","bcms.preview","bcms.grid","bcms.inlineEdit","bcms.redirect","bcms.pages.history","bcms.security","bcms.codeEditor","bcms.forms","bcms.antiXss"],function(a,c,t,f,D,h,o,i,C,s,y,m,j,z,n,A,e,k,b){var x={},B={contentId:"#bcmsContentId",contentVersion:"#bcmsPageContentVersion",pageContentId:"#bcmsPageContentId",parentPageContentId:"#bcmsParentPageContentId",contentFormRegionId:"#bcmsContentToRegionId",desirableStatus:"#bcmsContentDesirableStatus",dataPickers:".bcms-datepicker",htmlEditor:".bcms-contenthtml",destroyDraftVersionLink:".bcms-messages-draft-destroy",pageContentUserConfirmationHiddenField:"#bcms-user-confirmed-region-deletion",htmlContentJsCssTabOpener:'.bcms-tab-item[data-name="#bcms-tab-2"]',widgetsSearchButton:"#bcms-advanced-content-search-btn",widgetsSearchInput:"#bcms-advanced-content-search",widgetsContainer:"#bcms-advanced-contents-container",widgetCreateButton:"#bcms-create-advanced-content-button",widgetRegisterButton:"#bcms-registeradvanced-content-button",widgetInsertButtons:".bcms-js-insert",widgetDeleteButtons:".bcms-js-content-delete",widgetEditButtons:".bcms-js-content-edit",widgetContainerBlock:".bcms-js-preview-block",widgetCategory:".bcms-category",widgetName:".bcms-content-titles",widgetPreviewBox:".bcms-js-preview-box",widgetIFramePreview:".bcms-js-preview-box[data-as-image='False'] .bcms-js-zoom-overlay",widgetImagePreview:".bcms-js-preview-box[data-as-image='True'] .bcms-js-zoom-overlay",widgetButtonOpener:".bcms-btn-opener",widgetButtonHolder:".bcms-btn-opener-holder",anyTab:".bcms-tab-item",widgetsContent:".bcms-widgets",editInSourceModeHiddenField:"#bcms-edit-in-source-mode",contentTextModeHiddenField:"#bcms-content-text-mode",firstForm:"form:first",datePickers:"input.bcms-datepicker",editContentCloseInfoMessage:"#bcms-draft-closeinfomessage",editContentInfoMessageBox:".bcms-warning-messages",editorContainer:".bcms-window-tabbed-options",editorTitle:".bcms-content-titles",editorCheckBoxField:".bcms-check-field-helper",codeEditorParent:".bcms-input-list-holder",editorInfoBlock:".bcms-content-info-block",markdownEditorHeader:".markItUpHeader",markdownEditorFooter:".markItUpFooter"},d={sliderPrev:"bcms-slider-prev",sliderNext:"bcms-slider-next",inactive:"bcms-inactive",activeSearch:"bcms-active-search",opened:"bcms-opened"},r={loadWidgetsUrl:null,loadAddNewHtmlContentDialogUrl:null,insertContentToPageUrl:null,deletePageContentUrl:null,editPageContentUrl:null,sortPageContentUrl:null,previewPageUrl:null,selectWidgetUrl:null},l={addNewContentDialogTitle:null,editContentDialogTitle:null,deleteContentConfirmationTitle:null,deleteContentConfirmationMessage:null,deleteContentSuccessMessageTitle:null,deleteContentSuccessMessageMessage:null,deleteContentFailureMessageTitle:null,deleteContentFailureMessageMessage:null,sortPageContentFailureMessageTitle:null,sortPageContentFailureMessageMessage:null,sortingPageContentMessage:null,errorTitle:null,insertingWidgetInfoMessage:null,insertingWidgetInfoHeader:null,insertingWidgetErrorMessage:null,datePickerTooltipTitle:null,selectWidgetDialogTitle:null},g={htmlContent:"html-content"};x.links=r;x.globalization=l;x.onAddNewContent=function(F){var G,E=F.contentTextMode,J=F.regionViewModel,H=c.boolAsString(F.includeChildRegions),I=F.onSuccess||function(){z.ReloadWithAlert();};t.edit({title:l.addNewContentDialogTitle,disableSaveAndPublish:!A.IsAuthorized(["BcmsPublishContent"]),onLoad:function(K){var L=a.format(r.loadAddNewHtmlContentDialogUrl,c.pageId,J.id,J.parentPageContentId);i.bindDialog(K,L,{contentAvailable:function(M,N){var O=false,P=false;G=K.container.find(B.htmlEditor).attr("id");if(N&&N.Data){if(N.Data.EditInSourceMode){O=true;}if(N.Data.EnableInsertDynamicRegion){P=true;}}var Q={dialog:M,editInSourceMode:O,enableInsertDynamicRegion:P,editorId:G,data:N.Data,onSuccess:I,includeChildRegions:H,contentTextMode:E};x.initializeAddNewContentForm(Q);},beforePost:function(){var M=o.isSourceMode(G,E);K.container.find(B.editInSourceModeHiddenField).val(M);K.container.find(B.contentTextModeHiddenField).val(E);return true;},postSuccess:function(M){if(M.Data.DesirableStatus==c.contentStatus.preview){try{var N=M.Data;a(B.contentId).val(N.ContentId);a(B.pageContentId).val(N.PageContentId);y.previewPageContent(N.PageId,N.PageContentId);}finally{return false;}}else{if(a.isFunction(I)){I(M);}}return true;},formSerialize:function(M){return D.serializeFormWithChildWidgetOptions(M,G,null,function(N){if(H){N.IncludeChildRegions=true;}});},formContentType:"application/json; charset=UTF-8"});},onAccept:function(){o.destroyAllHtmlEditorInstances();},onClose:function(){o.destroyAllHtmlEditorInstances();}});};x.onSortPageContent=function(F){var I=F.models,J=F.onSuccess,H=t.info({content:l.sortingPageContentMessage,disableCancel:true,disableAccept:true});var K=r.sortPageContentUrl,E=function(){t.alert({title:l.sortPageContentFailureMessageTitle,content:l.sortPageContentFailureMessageMessage});},G=JSON.stringify({PageId:c.pageId,PageContents:I});a.ajax({type:"POST",url:K,contentType:"application/json; charset=utf-8",dataType:"json",cache:false,data:G,success:function(L){H.close();if(L.Success){if(a.isFunction(J)){J(L.Data.PageContents);}}else{if(L.Messages&&L.Messages.length>0){t.showMessages(L);}else{E();}}},error:function(){H.close();E();}});};function q(E,F){E.container.find(B.widgetCreateButton).on("click",function(){D.openCreateHtmlContentWidgetDialog(function(G){x.updateWidgetCategoryList(E,F);s.refreshBox(E.container,G);},null);});E.container.find(B.widgetRegisterButton).on("click",function(){D.openCreateServerControlWidgetDialog(function(G){x.updateWidgetCategoryList(E,F);s.refreshBox(E.container,G);},null);});E.container.find(B.widgetsSearchButton).on("click",function(){var G=a(this).parent();if(!G.hasClass(d.activeSearch)){E.container.find(B.widgetsSearchInput).prop("disabled",false);G.addClass(d.activeSearch);E.container.find(B.widgetsSearchInput).focus();}else{E.container.find(B.widgetsSearchInput).prop("disabled",true);G.removeClass(d.activeSearch);E.container.find(B.widgetsSearchInput).val("");}});c.preventInputFromSubmittingForm(E.container.find(B.widgetsSearchInput),{preventedEnter:function(){x.updateWidgetCategoryList(E,F,true);}});}x.initializeAddNewContentForm=function(G){var E=false,F;G=a.extend({enableInsertDynamicRegion:false,editorId:null,dialog:null,data:{},onSuccess:function(){},includeChildRegions:false,contentTextMode:f.contentTextModes.html},G);G.dialog.container.find(B.dataPickers).initializeDatepicker(l.datePickerTooltipTitle);G.dialog.container.find(B.anyTab).click(function(){setTimeout(function(){G.dialog.setFocus();},100);});G.dialog.container.find(B.htmlContentJsCssTabOpener).on("click",function(){if(!E){F={marginTop:30,topElements:[{element:B.editorTitle,takeMargins:true}],container:B.editorContainer,bottomElement:B.editorCheckBoxField,parent:B.codeEditorParent,marginBottom:1};e.initialize(G.dialog.container,G.dialog,null,F);E=true;}});if(G.contentTextMode==f.contentTextModes.markdown){F={topElements:[{element:B.editorInfoBlock,takeMargins:true},{element:B.markdownEditorHeader,takeMargins:true}],container:B.editorContainer,bottomElement:B.markdownEditorFooter,marginBottom:2};o.initializeMarkdownEditor(G.editorId,"",{},F);}if(G.contentTextMode==f.contentTextModes.simpleText){F={topElements:[{element:B.editorInfoBlock,takeMargins:true}],container:B.editorContainer,bottomElement:B.markdownEditorFooter,marginBottom:2};o.initializeMarkdownEditor(G.editorId,"",{hideIcons:true},F);}if(G.contentTextMode==f.contentTextModes.html){F={topElements:[{element:B.editorInfoBlock,takeMargins:true}],container:B.editorContainer};o.initializeHtmlEditor(G.editorId,"",{},G.editInSourceMode,F);if(G.enableInsertDynamicRegion){o.enableInsertDynamicRegion(G.editorId,true,G.data.LastDynamicRegionNumber);}}};x.initializeEditContentForm=function(J){var G=false,I;J=a.extend({dialog:null,editInSourceMode:false,enableInsertDynamicRegion:false,data:{},editorId:null,includeChildRegions:false,onSuccess:function(){},contentTextMode:f.contentTextModes.html},J);var E=A.IsAuthorized(["BcmsEditContent"]),F=A.IsAuthorized(["BcmsPublishContent"]),H=J.dialog.container.find(B.firstForm);J.dialog.container.find(B.htmlContentJsCssTabOpener).on("click",function(){if(!G){I={marginTop:30,topElements:[{element:B.editorTitle,takeMargins:true}],container:B.editorContainer,bottomElement:B.editorCheckBoxField,parent:B.codeEditorParent,marginBottom:1};e.initialize(J.dialog.container,J.dialog,null,I);G=true;}});if(J.contentTextMode==f.contentTextModes.markdown){I={topElements:[{element:B.editorInfoBlock,takeMargins:true},{element:B.markdownEditorHeader,takeMargins:true}],container:B.editorContainer,bottomElement:B.markdownEditorFooter,marginBottom:2};o.initializeMarkdownEditor(J.editorId,J.data.ContentId,{},I);}if(J.contentTextMode==f.contentTextModes.simpleText){I={topElements:[{element:B.editorInfoBlock,takeMargins:true}],container:B.editorContainer,bottomElement:B.markdownEditorFooter,marginBottom:2};o.initializeMarkdownEditor(J.editorId,J.data.ContentId,{hideIcons:true},I);}if(J.contentTextMode==f.contentTextModes.html){I={topElements:[{element:B.editorInfoBlock,takeMargins:true}],container:B.editorContainer};o.initializeHtmlEditor(J.editorId,J.data.ContentId,{},J.editInSourceMode,I);if(J.enableInsertDynamicRegion){o.enableInsertDynamicRegion(J.editorId,true,J.data.LastDynamicRegionNumber);}}J.dialog.container.find(B.editContentCloseInfoMessage).on("click",function(){J.dialog.container.find(B.editContentInfoMessageBox).hide();});J.dialog.container.find(B.destroyDraftVersionLink).on("click",function(){var K=J.dialog.container.find(B.contentId).val(),M=J.dialog.container.find(B.pageContentId).val(),L=J.dialog.container.find(B.contentVersion).val();n.destroyDraftVersion(K,L,J.includeChildRegions,J.dialog.container,function(O,N){J.dialog.close();x.editPageContent(M,{onCloseClick:function(){if(a.isFunction(J.onSuccess)){J.onSuccess(N);}else{z.ReloadWithAlert();}},onSuccess:J.onSuccess,includeChildRegions:J.includeChildRegions});});});if(H.data("readonly")!==true&&F&&!E){H.addClass(d.inactive);k.setFieldsReadOnly(H);a.each(H.find(B.datePickers),function(){var K=a(this);K.removeAttr("readonly");K.parent("div").css("z-index",c.getHighestZindex()+1);});}J.dialog.container.find(B.dataPickers).initializeDatepicker();};x.updateWidgetCategoryList=function(E,G,F){a.ajax({url:a.format(r.loadWidgetsUrl,E.container.find(B.widgetsSearchInput).val()),cache:false}).done(function(H){E.container.find(B.widgetsContainer).html(H);p(E.container,E,G,F);E.container.find(B.widgetsSearchInput).focus();});};function p(E,F,H,G){x.initializeLivePreview(E);E.find(B.widgetInsertButtons).on("click",H);E.find(B.widgetDeleteButtons).on("click",function(){var J=a(this),K=J.parents(B.widgetContainerBlock),L=K.data("original-id"),N=K.data("original-version"),M=K.find(B.widgetName).text(),I=function(O){s.refreshBox(t.last().container||K,O);K.hideLoading();};D.deleteWidget(L,N,M,function(){K.showLoading();},function(O){I(O);x.updateWidgetCategoryList(F,H);},I);});E.find(B.widgetEditButtons).on("click",function(){var I=a(this),J=I.parents(B.widgetContainerBlock),K=J.data("id"),L=J.data("type");D.editWidget(K,L,function(M){s.refreshBox(J,M);x.updateWidgetCategoryList(F,H);},null);});if(G){E.find(B.widgetsSearchButton).parent().addClass(d.activeSearch);}else{E.find(B.widgetsSearchInput).prop("disabled",true);}E.find(B.widgetButtonOpener).on("click",function(I){c.stopEventPropagation(I);var J=E.find(B.widgetButtonHolder);if(!J.hasClass(d.opened)){J.addClass(d.opened);}else{J.removeClass(d.opened);}});c.on(c.events.bodyClick,function(){var I=E.find(B.widgetButtonHolder);if(I.hasClass(d.opened)){I.removeClass(d.opened);}});y.initialize(E.find(B.widgetsContainer),B.widgetIFramePreview);F.container.find(B.widgetImagePreview).unbind("click");F.container.find(B.widgetImagePreview).on("click",function(){var J=a(this),K=J.data("previewUrl"),I=J.data("previewTitle");t.imagePreview(K,I);});}x.insertWidget=function(E){if(!E.regionViewModel){c.logger.error("Failed to insert the widget to the page. Missing region info.");return;}if(!E.widget){c.logger.error("Failed to insert the widget to the page. Missing widget info.");return;}E=a.extend({onSuccess:function(){z.ReloadWithAlert();}},E);console.log(E);var F=a.format(r.insertContentToPageUrl,c.pageId,E.widget.id,E.regionViewModel.id,E.regionViewModel.parentPageContentId,E.includeChildRegions||false);a.ajax({type:"POST",url:F,contentType:"application/json; charset=utf-8",dataType:"json",cache:false,beforeSend:function(){if(E.widget.dialog){E.widget.dialog.close();}E.widget.dialog=t.info({title:l.insertingWidgetInfoHeader,content:l.insertingWidgetInfoMessage,disableCancel:true,disableAccept:true});},success:function(G){if(E.widget.dialog){E.widget.dialog.close();}if(G&&G.Success){E.onSuccess(G);}else{t.alert({title:l.errorTitle,content:G.Messages?G.Messages[0]:l.insertingWidgetErrorMessage});}},error:function(){if(E.widget.dialog){E.widget.dialog.close();}t.alert({title:l.errorTitle,content:l.insertingWidgetErrorMessage});}});return false;};x.initializeLivePreview=function(E){var G=a(E).find(".bcms-modal-content .bcms-modal-frame-holder .bcms-window-options");var H=null;var F=[];a(E).find(B.widgetPreviewBox).each(function(){var J=a(this),I=J.data();if(!I.isLoaded){if(I.asImage==="True"){J.append(a.format('<img src="{0}" alt="{1}" />',I.previewUrl,I.title));}else{F.push(J);}J.data("isLoaded",true);}});G.scroll(function(){clearTimeout(H);return setTimeout(function(){a(F).each(function(){var L=a(this),J=L.data(),I=L.get(0).getBoundingClientRect(),K=I.top<window.innerHeight&&I.bottom>0,M=L.data("isVisable")||false;if(!M&&K){L.data("isVisable",true);L.append(a.format('<iframe class="{0}" width="{1}" height="{2}" scrolling="no" border="0" frameborder="0" src="{3}" style="background-color:white;"/>',J.frameCssClass,J.width,J.height,J.previewUrl));}else{if(M&&!K){L.data("isVisable",false);L.find("#iframe").remove();}}});},500);});G.scroll();};function u(F){var E=F.contentId,G=F.pageContentId;if(F.contentType==g.htmlContent){F.onEditContent=function(I,H){x.editPageContent(G,{onSuccess:I,includeChildRegions:H});};F.visibleButtons.configure=false;if(!A.IsAuthorized(["BcmsEditContent","BcmsPublishContent"])){F.visibleButtons.history=false;F.visibleButtons.edit=false;}if(!A.IsAuthorized(["BcmsEditContent"])){F.visibleButtons["delete"]=false;}}F.onDeleteContent=function(H){x.removeContentFromPage(F.pageContentId,F.pageContentVersion,b.encodeHtml(F.title),F.contentVersion,H);};F.onContentHistory=function(I,H){n.openPageContentHistoryDialog(E,G,{onContentRestore:I,includeChildRegions:H});};if(F.draft){F.visibleButtons.draft=true;}}x.editPageContent=function(F,L){L=a.extend({onCloseClick:null,onSuccess:null,includeChildRegions:false},L);var E=A.IsAuthorized(["BcmsEditContent"]),G=f.contentTextModes.html,J=L.onCloseClick,K=L.onSuccess,I=(L.includeChildRegions===true),H;t.edit({title:l.editContentDialogTitle,disableSaveDraft:!E,isPreviewAvailable:E,disableSaveAndPublish:!A.IsAuthorized(["BcmsPublishContent"]),onCloseClick:J,onLoad:function(M){var N=a.format(r.editPageContentUrl,F);i.bindDialog(M,N,{contentAvailable:function(O,R){var P=false,Q=false;H=M.container.find(B.htmlEditor).attr("id");if(R&&R.Data){if(R.Data.EditInSourceMode){P=true;}if(R.Data.ContentTextMode){G=R.Data.ContentTextMode;}if(R.Data.EnableInsertDynamicRegion){Q=true;}}x.initializeEditContentForm({dialog:O,editInSourceMode:P,enableInsertDynamicRegion:Q,data:R.Data,editorId:H,includeChildRegions:I,onSuccess:K,contentTextMode:G});},beforePost:function(){var O=o.isSourceMode(H,G);M.container.find(B.editInSourceModeHiddenField).val(O);return true;},postError:function(O){if(O.Data&&O.Data.ConfirmationMessage){t.confirm({content:O.Data.ConfirmationMessage,onAccept:function(){M.container.find(B.pageContentUserConfirmationHiddenField).val(true);M.submitForm();return true;}});}},postSuccess:function(O){if(O.Data.DesirableStatus==c.contentStatus.preview){try{y.previewPageContent(c.pageId,O.Data.PageContentId);}finally{return false;}}else{if(a.isFunction(K)){K(O);}else{z.ReloadWithAlert();}}return true;},formSerialize:function(O){return D.serializeFormWithChildWidgetOptions(O,H,null,function(P){if(I){P.IncludeChildRegions=true;}});},formContentType:"application/json; charset=utf-8"});},onAccept:function(){o.destroyAllHtmlEditorInstances();},onClose:function(){o.destroyAllHtmlEditorInstances();}});};x.removeContentFromPage=function(L,M,F,G,K){if(!K){K=function(){z.ReloadWithAlert({title:l.deleteContentSuccessMessageTitle,message:l.deleteContentSuccessMessageMessage,timeout:1500});};}var H=function(N){return a.format(r.deletePageContentUrl,L,M,G,N);},I=function(){return H(false);},J=function(N){try{if(N.Success){K(N);}else{if(N.Data&&N.Data.ConfirmationMessage){t.confirm({content:N.Data.ConfirmationMessage,onAccept:function(){I=function(){return H(true);};E.accept();return true;}});}else{if(N.Messages&&N.Messages.length>0){t.showMessages(N);}else{t.alert({title:l.deleteContentFailureMessageTitle,content:l.deleteContentFailureMessageMessage});}}}}finally{E.close();}},E=t.confirm({title:l.deleteContentConfirmationTitle,content:a.format(l.deleteContentConfirmationMessage,F),onAccept:function(){a.ajax({type:"POST",url:I(),contentType:"application/json; charset=utf-8",dataType:"json",cache:false}).done(function(N){J(N);}).fail(function(N){J(c.parseFailedResponse(N));});return false;}});};function v(F){if(F!=null){var H=F.LastDynamicRegionNumber||0,G=F.IsMasterPage===true,J,E;if(!G){H++;J="WidgetRegion"+H+"_"+c.createGuid().replace("-","");}else{H++;if(H==1){J="CMSMainContent";}else{J="ContentRegion"+H;}}F.LastDynamicRegionNumber=H;if(F.mode=="source"){E="<div>{{DYNAMIC_REGION:"+J+"}}</div>";F.addHtml(E);}else{E='<div class="bcms-draggable-region" data-cke-realelement="%3Cdiv%3E%7B%7BDYNAMIC_REGION%3A'+J+'%7D%7D%3C%2Fdiv%3E" data-cke-real-node-type="1" title="Dynamic Region" data-cke-real-element-type="cmsdynamicregion" isregion="true">Content to add</div>';var I=CKEDITOR.dom.element.createFromHtml(E,F.document);F.insertElement(I);}}}function w(G){if(!a.isFunction(G.onInsert)&&!G.regionViewModel){return;}if(!a.isFunction(G.onInsert)){G.onInsert=function(H){G.widget=H;x.insertWidget(G);};}var E,F=function(){var L=a(this).parents(B.widgetContainerBlock),H=L.data("original-id").toUpperCase(),K=L.find(B.widgetName).text(),I='<widget data-id="'+H+'" data-assign-id="'+c.createGuid()+'">'+K+"</widget>";var J=G.onInsert({id:H,title:K,html:I,dialog:E});if(J!==false){E.close();}};E=t.open({title:l.selectWidgetDialogTitle,disableAccept:true,onLoad:function(H){var I=r.selectWidgetUrl;i.bindDialog(H,I,{contentAvailable:function(J){q(J,F);p(J.container,J,F);}});}});}x.init=function(){c.logger.debug("Initializing bcms.pages.content module.");};c.on(c.events.addPageContent,x.onAddNewContent);c.on(c.events.sortPageContent,x.onSortPageContent);c.on(c.events.contentModelCreated,u);c.on(o.events.insertDynamicRegion,v);c.on(c.events.insertWidget,w);c.registerInit(x.init);return x;});bettercms.define("bcms.pages.languages",["bcms.jquery","bcms","bcms.modal","bcms.ko.extenders","bcms.autocomplete","bcms.antiXss"],function(a,d,h,f,c,b){var i={openPageSelectDialog:null},j={},g={suggestUntranslatedPagesUrl:null,searchUntranslatedPagesUrl:null},e={unassignTranslationConfirmation:null,invariantLanguage:null,replaceItemWithCurrentLanguageConfirmation:null,replaceItemWithLanguageConfirmation:null,assigningPageHasSameCultureAsCurrentPageMessage:null};i.links=g;i.globalization=e;i.selectors=j;var k=(function(l){d.extendsClass(m,l);function m(o,n){var p={serviceUrl:g.suggestUntranslatedPagesUrl,onItemSelect:o};l.call(this,p);this.onAppendWithIncludedIds=n;}m.prototype.getAdditionalParameters=function(){var n=l.prototype.getAdditionalParameters.call(this);if(a.isFunction(this.onAppendWithIncludedIds)){n=this.onAppendWithIncludedIds(n);}return n;};return m;})(c.AutocompleteViewModel);i.PageLanguageViewModel=function(p,o){var q=this,m,n;q.languageId=f.observable(o);q.suspendLanguageCheck=false;q.languages=[];q.languages.push({key:"",value:e.invariantLanguage});for(m=0,n=p.length;m<n;m++){q.languages.push({key:p[m].Key,value:p[m].Value});}return q;};i.PageTranslationsListViewModel=function(p,r,q,u){var v=this;v.language=new i.PageLanguageViewModel(r,q);v.items=f.observableArray();v.isInAddMode=f.observable(false);v.hasFocus=f.observable(false);v.addLanguageId=f.observable();v.addPageId=f.observable();v.addPageTitle=f.observable();v.oldCurrentPageLanguageId=q;v.currentPageId=u;v.pageLanguageId=null;v.pageUrl=null;v.originalItems=[];function t(y,z,A,B){if(z==v.language.languageId()){h.info({content:a.format(e.assigningPageHasSameCultureAsCurrentPageMessage,A)});return false;}var x;v.pageLanguageId=z;v.pageUrl=B;v.addPageId(y);v.addPageTitle(A);x=v.addingPageLanguages();if(x.length>0){v.addLanguageId(x[0].key);}else{v.addLanguageId("");}return true;}function n(){v.hasFocus(false);v.isInAddMode(false);v.addLanguageId("");v.addPageId("");v.pageLanguageId=null;v.addPageTitle("");v.pageUrl=null;}function m(y,x){if(y!==""){y+="|";}y+=x;return y;}function o(){var F={},C="",x=v.currentPageId,B=v.originalItems.length,E=v.items().length,z,D,y,A;for(z=0;z<B;z++){A=v.originalItems[z];y=false;for(D=0;D<E;D++){if(v.items()[D].id()==A){y=true;break;}}if(!y){C=m(C,A);}}for(D=0;D<E;D++){x=m(x,v.items()[D].id());}F.ExcplicitlyIncludedPages=C;F.ExistingItems=x;F.ExcludedLanguageId=v.language.languageId();return F;}function w(x){return a.extend(o(),x);}function s(B){var z=v.items().length,y,A,x=false;n();for(y=0;y<z;y++){A=v.items()[y];if(!v.language.suspendLanguageCheck&&A.languageId()==B){x=true;h.confirm({content:a.format(e.replaceItemWithCurrentLanguageConfirmation,A.languageName()),onAccept:function(){v.items.remove(A);v.oldCurrentPageLanguageId=B;return true;},onClose:function(){v.language.suspendLanguageCheck=true;v.language.languageId(v.oldCurrentPageLanguageId);v.language.suspendLanguageCheck=false;return true;}});break;}}if(!x){v.oldCurrentPageLanguageId=B;}}v.autocompleteViewModel=new k(function(y,x){return t(y.id(),x.LanguageId,y.name(),x.PageUrl);},w);v.language.languageId.subscribe(s);v.startEditMode=function(){if(!v.isInAddMode()){v.hasFocus(true);v.isInAddMode(true);}};v.endEditMode=function(){n();};v.selectPage=function(){i.openPageSelectDialog({onAccept:function(x){return t(x.Id,x.LanguageId,x.Title,x.PageUrl);},params:o(),url:g.searchUntranslatedPagesUrl});};v.unassignPage=function(x){h.confirm({content:e.unassignTranslationConfirmation,onAccept:function(){n();v.items.remove(x);return true;}});};v.addingPageLanguages=f.computed(function(){if(!v.addPageId()){return[];}var z=[],B=v.language.languages.length,x=v.language.languageId(),C=v.pageLanguageId,y,A;for(y=0;y<B;y++){A=v.language.languages[y];if(A.key!=x&&(C==A.key||!C)){z.push({key:A.key||d.constants.emptyGuid,value:A.value||e.invariantLanguage});}}return z;});v.addTranslation=function(){if(v.isInAddMode()&&v.addLanguageId()&&v.addPageId()){var y=v.addLanguageId()==d.constants.emptyGuid?"":v.addLanguageId(),x=function(F){var E=v.language.languages.length,C,D;for(C=0;C<E;C++){D=v.language.languages[C];if(D.key==y){if(F==null){F=new i.PageTranslationViewModel(v);v.items.push(F);}F.id(v.addPageId());F.title(v.addPageTitle());F.url(v.pageUrl);F.languageId(y);F.languageName(D.value||e.invariantLanguage);n();}}},B=v.items().length,A,z;for(A=0;A<B;A++){z=v.items()[A];if(z.languageId()==y){v.hasFocus(false);h.confirm({content:e.replaceItemWithLanguageConfirmation,onAccept:function(){x(z);return true;},onClose:function(){v.hasFocus(true);}});return;}}x();}};function l(){if(!p){p=[];}var C=p.length,B=v.language.languages.length,E,x,z,A,y,D;for(x=0;x<B;x++){A=v.language.languages[x];D=null;for(z=0;z<C;z++){y=p[z];if((y.LanguageId||"")==A.key){D=y;break;}}if(D&&D.Id!=v.currentPageId){E=new i.PageTranslationViewModel(v);E.id(D.Id);E.title(b.encodeHtml(D.Title));E.url(D.PageUrl);E.languageName(A.value||e.invariantLanguage);E.languageId(A.key);v.items.push(E);v.originalItems.push(D.Id);}}}l();return v;};i.PageTranslationViewModel=function(l,o,m){var n=this;n.parent=m;n.id=f.observable(o?o.Id:"");n.title=f.observable(o?o.Title:"");n.url=f.observable(o?o.PageUrl:"");n.languageName=f.observable(l?l.value||e.invariantLanguage:"");n.languageId=f.observable(l?l.key:"");n.getPropertyIndexer=function(p,q){return"Translations["+p+"]."+q;};return n;};i.init=function(){d.logger.debug("Initializing bcms.pages.languages module.");};d.registerInit(i.init);return i;});bettercms.define("bcms.pages.history",["bcms.jquery","bcms","bcms.modal","bcms.messages","bcms.dynamicContent","bcms.redirect","bcms.grid"],function(a,b,j,i,d,l,f){var g={},c={tableActiveRow:"bcms-table-row-active"},o={gridRestoreLinks:"#bcms-pagecontenthistory-form tr .bcms-js-restore",gridCells:"#bcms-pagecontenthistory-form tr td",gridRowPreviewLink:".bcms-js-preview:first",firstRow:"tr:first",gridRows:"#bcms-pagecontenthistory-form tr",versionPreviewContainer:"#bcms-history-preview",versionPreviewPropertiesContainer:"#bcms-history-preview-properties",versionPreviewLoaderContainer:".bcms-history-preview",versionPreviewTemplate:"#bcms-history-preview-template",pageContentHistoryForm:"#bcms-pagecontenthistory-form",pageContentHistorySearchButton:".bcms-btn-search",pageContentHistorySearchField:".bcms-search-query",modalContent:".bcms-modal-content",modalFrameHolder:".bcms-modal-frame-holder",activeTab:".bcms-js-tab-header .bcms-modal-frame-holder>.bcms-active",inactiveTab:".bcms-js-tab-header .bcms-modal-frame-holder>:not(.bcms-active)"},h={loadContentHistoryDialogUrl:null,loadContentVersionPreviewUrl:null,loadContentVersionPreviewPropertiesUrl:null,restoreContentVersionUrl:null,destroyContentDraftVersionUrl:null},e={contentHistoryDialogTitle:null,contentVersionRestoreConfirmation:null,contentVersionDestroyDraftConfirmation:null,versionPreviewNotAvailableMessage:null,restoreButtonTitle:null,closeButtonTitle:null};g.links=h;g.globalization=e;function k(q,r){var z=a.format(h.loadContentVersionPreviewUrl,r),u=a(q.find(o.versionPreviewTemplate).html()),t=q.find(o.versionPreviewContainer),s=q.find(o.versionPreviewContainer),p=q.find(o.activeTab),y=a.format(h.loadContentVersionPreviewPropertiesUrl,r),w=q.find(o.versionPreviewPropertiesContainer),x=q.find(o.versionPreviewPropertiesContainer),v='<div class="bcms-history-preview" id="bcms-history-preview-properties" style="height: 100%"><div class="bcms-history-info" style="display: block;">'+e.versionPreviewNotAvailableMessage+"</div></div>";t.html(u);if(p.data("name")==="#bcms-tab-1"){s.showLoading();}else{x.showLoading();}u.on("load",function(){s.hideLoading();});u.attr("src",z);a.ajax({type:"GET",cache:false,url:y}).done(function(A){x.hideLoading();if(A===""){w.html(v);}else{w.html(A);}}).fail(function(){x.hideLoading();w.html(v);});}function m(q,p,r,t,s){var u=function(v){var x=a.format(h.restoreContentVersionUrl,r,v,s),w=function(y){i.refreshBox(p,y);if(y.Success){if(a.isFunction(t)){q.close();t(y);}else{l.ReloadWithAlert();}}else{if(y.Data&&y.Data.ConfirmationMessage){j.confirm({content:y.Data.ConfirmationMessage,onAccept:function(){u(1);}});}}};a.ajax({type:"POST",cache:false,url:x}).done(function(y){w(y);}).fail(function(y){w(b.parseFailedResponse(y));});};j.confirm({content:e.contentVersionRestoreConfirmation,acceptTitle:e.restoreButtonTitle,onAccept:function(){u(0);}});}function n(q,p,r){f.submitGridForm(r,function(t){var s=q.container.find(o.activeTab).data("name"),u=q.container.find(o.inactiveTab).data("name");r.closest(o.modalFrameHolder).html(t);q.container.find(s).show();q.container.find(u).hide();g.initPageContentHistoryDialogEvents(q,t,true);});}g.initPageContentHistoryDialogEvents=function(q,t,s){var p=q.container.find(o.modalContent);p.find(o.gridRestoreLinks).on("click",function(u){b.stopEventPropagation(u);m(q,p,a(this).data("id"),t.onContentRestore,t.includeChildRegions);});p.find(o.gridCells).on("click",function(){var x=a(this),w=x.parents(o.firstRow),v=w.find(o.gridRowPreviewLink),u=v.data("id");p.find(o.gridRows).removeClass(c.tableActiveRow);w.addClass(c.tableActiveRow);k(p,u);});var r=p.find(o.pageContentHistoryForm);f.bindGridForm(r,function(v){var u=q.container.find(o.activeTab).data("name"),w=q.container.find(o.inactiveTab).data("name");r.closest(o.modalFrameHolder).html(v);q.container.find(u).show();q.container.find(w).hide();g.initPageContentHistoryDialogEvents(q,t,s);});r.on("submit",function(u){b.stopEventPropagation(u);n(q,p,r);return false;});b.preventInputFromSubmittingForm(r.find(o.pageContentHistorySearchField),{preventedEnter:function(){n(q,p,r);}});r.find(o.pageContentHistorySearchButton).on("click",function(){var u=a(this).parent();if(!u.hasClass("bcms-active-search")){r.find(o.pageContentHistorySearchField).prop("disabled",false);u.addClass("bcms-active-search");r.find(o.pageContentHistorySearchField).focus();}else{r.find(o.pageContentHistorySearchField).prop("disabled",true);u.removeClass("bcms-active-search");r.find(o.pageContentHistorySearchField).val("");}});if(s===true){r.find(o.pageContentHistorySearchButton).parent().addClass("bcms-active-search");}else{r.find(o.pageContentHistorySearchField).prop("disabled",true);}};g.openPageContentHistoryDialog=function(p,r,q){q=a.extend({onContentRestore:null,includeChildRegions:false},q);j.open({title:e.contentHistoryDialogTitle,cancelTitle:e.closeButtonTitle,disableAccept:true,onLoad:function(s){var t=a.format(h.loadContentHistoryDialogUrl,p,r);d.bindDialog(s,t,{contentAvailable:function(){g.initPageContentHistoryDialogEvents(s,q);},beforePost:function(){s.container.showLoading();},postComplete:function(){s.container.hideLoading();}});}});};g.destroyDraftVersion=function(q,t,r,p,s){j.confirm({content:e.contentVersionDestroyDraftConfirmation,acceptTitle:e.destroyButtonTitle,onAccept:function(){var v=a.format(h.destroyContentDraftVersionUrl,q,t,r?1:0),u=function(w){p.hideLoading();var x=p.find(i.selectors.messages).last();if(x.length==0){x=p;}i.refreshBox(x,w);if(w.Success){if(a.isFunction(s)){var y=w.Data?w.Data.PublishedId:null;s.call(this,y,w);}}};p.showLoading();a.ajax({type:"POST",cache:false,url:v}).done(function(w){u(w);}).fail(function(w){u(b.parseFailedResponse(w));});}});};return g;});bettercms.define("bcms.pages",["bcms.jquery","bcms","bcms.modal","bcms.siteSettings","bcms.forms","bcms.dynamicContent","bcms.pages.properties","bcms.grid","bcms.redirect","bcms.messages","bcms.pages.filter","bcms.options","bcms.ko.extenders","bcms.security","bcms.sidemenu","bcms.datepicker","bcms.pages.languages","bcms.store","bcms.antiXss",],function(a,c,q,E,i,g,x,k,A,p,h,t,n,B,D,f,w,F,b){var u={},C={editPermalink:"#bcms-page-editpermalink",editPermalinkBox:".bcms-js-edit-box",editPermalinkClose:"div.bcms-js-edit-box .bcms-tip-close, div.bcms-js-edit-box .bcms-btn-cancel",editPermalinkSave:"#bcms-save-permalink",editPermalinkHiddenField:"#bcms-page-permalink",editPermalinkEditField:"#bcms-page-permalink-edit",editPermalinkInfoField:"#bcms-page-permalink-info",addNewPageTitleInput:"#PageTitle",addNewPageCloseInfoMessage:"#bcms-addnewpage-closeinfomessage",addNewPageCloseInfoMessageBox:".bcms-js-info-message",addNewPageTemplateSelect:".bcms-js-grid-box",addNewPageTemplateId:"#TemplateId",addNewPageMasterPageId:"#MasterPageId",addNewPageForm:"form:first",addNewPageTabContent:".bcms-window-tabbed-options",addNewPageOptionsTab:"#bcms-tab-2",addNewPageUserAccess:"#bcms-accesscontrol-context",siteSettingsPagesListForm:"#bcms-pages-form",siteSettingsPagesListFormFilterIncludeArchived:"#IncludeArchived",siteSettingsPagesSearchButton:"#bcms-pages-search-btn",siteSettingsPagesSearchField:".bcms-search-query",siteSettingsPageCreateButton:"#bcms-create-page-button",siteSettingsPageEditButton:".bcms-js-edit-button",siteSettingsPageDeleteButton:".bcms-grid-item-delete-button",siteSettingsPageRowTemplate:"#bcms-pages-list-row-template",siteSettingsPageBooleanTemplateTrue:"#bcms-boolean-true-template",siteSettingsPageBooleanTemplateFalse:"#bcms-boolean-false-template",siteSettingsPageRowTemplateFirstRow:".bcms-list-row:first",siteSettingsPageParentRow:".bcms-js-list-row:first",siteSettingsPagesTableFirstRow:".bcms-list-pages > .bcms-js-list-row:first",siteSettingsPagesTableRows:".bcms-js-list-row",siteSettingsPagesTableActiveRow:".bcms-list-pages > div.bcms-list-row-active:first",siteSettingsPagesParentTable:".bcms-list-pages:first",siteSettingsRowCells:".bcms-js-list-row",siteSettingsPagesGrid:"#bcms-pages-grid",siteSettingPageTitleCell:".bcms-page-title",siteSettingPageCreatedCell:".bcms-page-created",siteSettingPageModifiedCell:".bcms-page-modified",siteSettingPageStatusCell:".bcms-page-ispublished",siteSettingPageHasSeoCell:".bcms-page-hasseo",siteSettingsPager:".bcms-top-block-pager",hiddenPageNumberField:"#bcms-grid-page-number",clonePageForm:"form:first",cloneWithLanguageGoToPagePropertiesLink:"#bcms-open-page-translations",pagePropertiesTranslationsTab:'.bcms-js-tab-header .bcms-tab-item[data-name="#bcms-tab-5"]',languageSelection:"#LanguageId"},o={loadEditPropertiesUrl:null,loadSiteSettingsPageListUrl:null,loadSiteSettingsPagesJsonUrl:null,loadAddNewPageDialogUrl:null,deletePageConfirmationUrl:null,changePublishStatusUrl:null,clonePageDialogUrl:null,clonePageWithLanguageDialogUrl:null,convertStringToSlugUrl:null,loadSelectPageUrl:null,},j={editPagePropertiesModalTitle:null,addNewPageDialogTitle:null,addNewMasterPageDialogTitle:null,deletePageDialogTitle:null,pageDeletedTitle:null,pageDeletedMessage:null,clonePageDialogTitle:null,clonePageWithLanguageDialogTitle:null,cloneButtonTitle:null,deleteButtonTitle:null,pageStatusChangeConfirmationMessagePublish:null,pageStatusChangeConfirmationMessageUnPublish:null,selectPageDialogTitle:null,selectPageSelectButtonTitle:null,pageNotSelectedMessage:null,pagesListTitle:null,created:null,lastEdited:null},m={addNewPageInfoMessageClosed:"bcms.addNewPageInfoBoxClosed"},d={inputValidationError:"bcms-input-validation-error"},z=false,r="";u.links=o;u.globalization=j;u.senderId=0;function I(M,K,J,R,L,P,O,N){var Q=this;Q.dialog=M;Q.addPrefix=K;Q.actionUrl=J;Q.titleField=R;Q.autoGenerate=L;Q.getParentPageId=P;Q.getLanguageId=O;Q.getCategoryId=N;Q.Regenerate=function(){var U,T,S;if(Q.getParentPageId!=null&&a.isFunction(Q.getParentPageId)){U=Q.getParentPageId();}if(Q.getLanguageId!=null&&a.isFunction(Q.getLanguageId)){T=Q.getLanguageId();}if(Q.getCategoryId!=null&&a.isFunction(Q.getCategoryId)){S=Q.getCategoryId();}u.changeUrlSlug(Q.dialog,Q.actionUrl,Q.titleField,Q.addPrefix,U,T,S);};return Q;}function H(K){var J=this;J.id=K.TemplateId;J.previewUrl=K.PreviewUrl;J.previewThumbnailUrl=K.PreviewThumbnailUrl;J.title=K.Title;J.isActive=n.observable(K.IsActive);J.isCircularToCurrent=K.IsCircularToCurrent;J.isCompatible=K.IsCompatible;J.isMasterPage=K.IsMasterPage;J.select=function(){};J.previewImage=function(){q.imagePreview(J.previewUrl,J.title);};}function G(Q,L,O,N,J){var P=this;P.templates=n.observableArray();P.displayedTemplates=n.observableArray();P.searchQuery=n.observable();P.searchEnabled=n.observable(false);P.hasFocus=n.observable(false);P.optionsContainer=O;P.optionListViewModel=N;P.accessControlViewModel=J;P.dialog=L;for(var M=0;M<Q.length;M++){var K=new H(Q[M]);P.templates.push(K);}P.searchQuery.subscribe(function(){P.search();});P.displayTemplates=function(){if(P.templates()!=null){P.displayedTemplates.removeAll();var T=(P.searchQuery()||"").toLowerCase();for(var S=0;S<P.templates().length;S++){var R=P.templates()[S];if(T&&R.title.toLowerCase().indexOf(T)<0){continue;}P.displayedTemplates.push(R);}}};P.search=function(){P.displayTemplates();};P.toggleSearch=function(){if(!P.searchEnabled()){P.searchEnabled(true);P.hasFocus(true);}else{P.searchEnabled(false);P.searchQuery("");}};P.setActive=function(T){var R=P.findCurrentActive();if(R.id===T.id){return;}var S=p.box({container:L.container});S.clearMessages();if(T.isCircular){S.addWarningMessage(j.selectedMasterIsChildPage);return;}R.isActive(false);if(T.isMasterPage){L.container.find(C.addNewPageMasterPageId).val(T.id);L.container.find(C.addNewPageTemplateId).val("");}else{L.container.find(C.addNewPageTemplateId).val(T.id);L.container.find(C.addNewPageMasterPageId).val("");}T.isActive(true);x.loadLayoutOptions(T.id,T.isMasterPage,L.container,P.optionsContainer,P.optionListViewModel);x.loadLayoutUserAccess(T.id,T.isMasterPage,L.container,P.accessControlViewModel);};P.findCurrentActive=function(){for(var R=0;R<P.templates().length;R++){if(P.templates()[R].isActive()){return P.templates()[R];}}return null;};P.displayTemplates();}u.initializePermalinkBox=function(M,K,J,R,L,Q,P,O){var N=new I(M,K,J,R,L,Q,P,O);z=false;r="";M.container.find(C.editPermalink).on("click",function(){u.showAddNewPageEditPermalinkBox(M);});M.container.find(C.editPermalinkClose).on("click",function(){u.closeAddNewPageEditPermalinkBox(M);});M.container.find(C.editPermalinkSave).on("click",function(){u.saveAddNewPageEditPermalinkBox(M);});if(L){M.container.find(R).on("keyup",function(){var S=a(this).val()||"";if(S!=r){r=S;N.Regenerate();}});}M.container.find(C.editPermalinkEditField).on("keyup",function(){z=true;});M.container.find(C.addNewPageForm).on("submit",function(){if(!M.container.find(C.editPermalinkEditField).valid()){u.showAddNewPageEditPermalinkBox(M);}});c.preventInputFromSubmittingForm(M.container.find(C.editPermalinkEditField),{preventedEnter:function(){M.container.find(C.editPermalinkEditField).blur();u.saveAddNewPageEditPermalinkBox(M);},preventedEsc:function(){M.container.find(C.editPermalinkEditField).blur();u.closeAddNewPageEditPermalinkBox(M);}});return N;};u.isEditedPageUrlManually=function(){return z;};u.initAddNewPageDialogEvents=function(L,K){var O=F.get(m.addNewPageInfoMessageClosed),Q=L.container.find(C.addNewPageOptionsTab),J=B.createUserAccessViewModel(K.Data.UserAccessList),P=K.Data.Languages?new w.PageLanguageViewModel(K.Data.Languages):null,R=t.createOptionValuesViewModel(Q,K.Data.OptionValues,K.Data.CustomOptions),S={accessControl:J,language:P,options:R,templatesList:new G(K.Data.Templates,L,Q,R,J)},N=function(){if(P!=null){return P.languageId();}return null;};var M=u.initializePermalinkBox(L,true,o.convertStringToSlugUrl,C.addNewPageTitleInput,true,null,N,null);if(P!=null){P.languageId.subscribe(function(){M.Regenerate();});}if(O&&O==="1"){u.hideAddNewPageInfoMessage(L);}else{L.container.find(C.addNewPageCloseInfoMessage).on("click",function(){F.set(m.addNewPageInfoMessageClosed,"1");u.hideAddNewPageInfoMessage(L);});}n.applyBindings(S,L.container.find(C.addNewPageForm).get(0));return S;};u.showAddNewPageEditPermalinkBox=function(J){J.container.find(C.editPermalinkBox).show();J.container.find(C.editPermalinkEditField).focus();};u.saveAddNewPageEditPermalinkBox=function(J){if(a(C.editPermalinkEditField).valid()){var K=J.container.find(C.editPermalinkEditField).val();J.container.find(C.editPermalinkHiddenField).val(K);J.container.find(C.editPermalinkInfoField).html(K?K:"&nbsp;");u.hideAddNewPageEditPermalinkBox(J);}};u.closeAddNewPageEditPermalinkBox=function(J){var L=J.container.find(C.editPermalinkHiddenField).val(),K=J.container.find(C.editPermalinkEditField);K.val(L);K.blur();u.hideAddNewPageEditPermalinkBox(J);};u.hideAddNewPageEditPermalinkBox=function(J){J.container.find(C.editPermalinkBox).hide();};u.hideAddNewPageInfoMessage=function(J){J.container.find(C.addNewPageCloseInfoMessageBox).hide();};u.changePublishStatus=function(N){var M=!N.hasClass("bcms-switch-on"),K=M?j.pageStatusChangeConfirmationMessagePublish:j.pageStatusChangeConfirmationMessageUnPublish,J={PageId:c.pageId,IsPublished:M},L=function(O){q.showMessages(O);if(O.Success){setTimeout(function(){c.reload();},500);}};q.confirm({content:K,onAccept:function(){if(J.IsPublished){N.removeClass("bcms-switch-off");N.addClass("bcms-switch-on");}else{N.removeClass("bcms-switch-on");N.addClass("bcms-switch-off");}a.ajax({type:"POST",url:o.changePublishStatusUrl,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(J)}).done(function(O){L(O);}).fail(function(O){L(c.parseFailedResponse(O));});return true;},onClose:function(){}});};u.openCreatePageDialog=function(L,J){var K,M=a.format(o.loadAddNewPageDialogUrl,window.location.pathname,J||false),N;q.open({title:J===true?j.addNewMasterPageDialogTitle:j.addNewPageDialogTitle,onLoad:function(O){g.bindDialog(O,M,{contentAvailable:function(P,Q){N=u.initAddNewPageDialogEvents(P,Q);},beforePost:function(){if(!z){var P=O.container.find(C.editPermalinkEditField);K=P.val();P.val(null);}return N.options.isValid(true);},postError:function(){if(!z){var P=O.container.find(C.editPermalinkEditField);P.val(K);}},postSuccess:function(P){if(c.trigger(c.events.pageCreated,{Data:P.Data,Callback:L})<=0){if(L&&a.isFunction(L)){L(P);}}}});}});};u.addNewPage=function(){u.openCreatePageDialog(function(J){if(J.Data&&J.Data.PageUrl){D.turnEditModeOn();A.RedirectWithAlert(J.Data.PageUrl);}});};u.deleteCurrentPage=function(){var J=c.pageId;u.deletePage(J,function(L){if(L&&L.Messages&&L.Messages.length>1){var M=L.Messages[0];for(var K=1;K<L.Messages.length;K++){M=M+"<br>"+L.Messages[K];}q.info({title:j.pageDeletedTitle,content:M,onAcceptClick:function(){A.RedirectWithAlert("/",{title:j.pageDeletedTitle,message:j.pageDeletedMessage});}});}else{A.RedirectWithAlert("/",{title:j.pageDeletedTitle,message:j.pageDeletedMessage});}});};u.deletePage=function(J,K,L){L=L||j.deletePageDialogTitle;q.confirmDelete({title:L,acceptTitle:j.deleteButtonTitle,onLoad:function(M){var N=a.format(o.deletePageConfirmationUrl,J);g.bindDialog(M,N,{postSuccess:K});},onAcceptClick:function(){a(".bcms-error-frame").showLoading();}});};u.changeUrlSlug=function(M,J,Q,K,P,N,L){var O=a.trim(M.container.find(Q).val());setTimeout(function(){var W=a.trim(M.container.find(Q).val()),V=u.senderId++,T=function(Y){if(Y&&Y.SenderId==V&&Y.Url){var Z=Y.Url,aa=(Z?Z:"");if(aa.substr(0,1)!="/"){aa="/"+aa;}M.container.find(C.editPermalinkEditField).val(aa);M.container.find(C.editPermalinkHiddenField).val(aa);M.container.find(C.editPermalinkInfoField).html(aa);z=false;}};if(W&&O==W){var U=(K)?encodeURIComponent(window.location.pathname):"";var X=a.format(J,encodeURIComponent(W),V,U,P,N);if(L){for(var S=0;S<L.length;S++){var R="&";if(X.indexOf("?")===-1){R="?";}X=X.concat(R+"categoryId="+L[S]);}}a.ajax({type:"GET",url:X,dataType:"json"}).done(function(Y){T(Y);}).fail(function(Y){T(Y);});}},400);};u.loadSiteSettingsPageList=function(J){g.bindSiteSettings(E,u.links.loadSiteSettingsPageListUrl,{contentAvailable:u.initializeSiteSettingsPagesList});};function s(K,J){if(K.Data!=null){J.update(K.Data);}}function y(K,L,J,M){var N=this;N.selectedRowId=n.observable("");N.items=n.observableArray();N.items.extend({rateLimit:50});N.setItems=function(O){N.items.removeAll();for(var P=0;P<O.length;P++){N.items.push(new v(O[P],N,M.canBeSelected));}};N.onOpenPage=function(O){L.find(C.hiddenPageNumberField).val(O);k.submitGridFormPaged(L,function(P,Q){N.setItems(Q.Items);});};N.setItems(K.Items);N.paging=new n.PagingViewModel(K.GridOptions.PageSize,K.GridOptions.PageNumber,K.GridOptions.TotalCount,N.onOpenPage);return N;}u.initializeSiteSettingsPagesList=function(K,P,Q,O){Q=a.extend({dialog:E.getModalDialog(),dialogContainer:E,canBeSelected:false},Q);var L=Q.dialog,J=L.container,M=L.container.find(C.siteSettingsPagesListForm);u.pagesGridViewModel=new y(((K.Data)?K.Data:P),M,J,Q);var N=J.find(C.siteSettingsPagesGrid);n.cleanNode(N.get(0));var R=J.find(C.siteSettingsPager);n.applyBindings(u.pagesGridViewModel,N.get(0));n.applyBindings(u.pagesGridViewModel.paging,R.get(0));M.on("submit",function(S){S.preventDefault();u.searchSiteSettingsPages(M,J);return false;});c.preventInputFromSubmittingForm(M.find(C.siteSettingsPagesSearchField),{preventedEnter:function(){u.searchSiteSettingsPages(M,J);}});M.find(C.siteSettingsPagesSearchButton).on("click",function(){var S=a(this).parent();if(!S.hasClass("bcms-active-search")){M.find(C.siteSettingsPagesSearchField).prop("disabled",false);S.addClass("bcms-active-search");M.find(C.siteSettingsPagesSearchField).focus();}else{M.find(C.siteSettingsPagesSearchField).prop("disabled",true);S.removeClass("bcms-active-search");M.find(C.siteSettingsPagesSearchField).val("");}});if(O){M.find(C.siteSettingsPagesSearchButton).parent().addClass("bcms-active-search");}else{M.find(C.siteSettingsPagesSearchField).prop("disabled",true);}J.find(C.siteSettingsPageCreateButton).on("click",function(){u.addSiteSettingsPage(J,Q);});h.bind(J,((K.Data)?K.Data:P),function(S){u.searchSiteSettingsPages(M,J,S);},Q);k.focusSearchInput(L.container.find(C.siteSettingsPagesSearchField),true);};function v(K,L,J){var M=this;M.id=n.observable(K.Id);M.title=n.observable(K.Title);M.createdOn=n.observable(j.created+" "+K.CreatedOn);M.modifiedOn=n.observable(j.lastEdited+" "+K.ModifiedOn);M.pageStatus=n.observable(K.PageStatus);M.url=n.observable(K.PageUrl);M.version=n.observable(K.Version);M.update=function(N){M.id(N.PageId);M.title(N.Title);M.createdOn(j.created+" "+N.CreatedOn);M.modifiedOn(j.lastEdited+" "+N.ModifiedOn);M.pageStatus(N.PageStatus);M.url(N.PageUrl);M.version(N.Version);};M.canBeSelected=J;M.onEditClick=function(){u.editSiteSettingsPage(M);};M.onTitleClick=function(){window.open(M.url());};M.onDeleteClick=function(){u.deleteSiteSettingsPage(M);};M.onSelect=function(){if(!M.canBeSelected){return;}L.selectedRowId(M.id());};return M;}u.searchSiteSettingsPages=function(K,J,L){if(L){k.submitGridFormPaged(K,function(N,M){J.find(C.siteSettingsPagesSearchField).blur();u.pagesGridViewModel.setItems(M.Items);u.pagesGridViewModel.paging.setPaging(M.GridOptions.PageSize,M.GridOptions.PageNumber,M.GridOptions.TotalCount);});}else{k.submitGridForm(K,function(N,M){J.find(C.siteSettingsPagesSearchField).blur();u.pagesGridViewModel.setItems(M.Items);u.pagesGridViewModel.paging.setPaging(M.GridOptions.PageSize,M.GridOptions.PageNumber,M.GridOptions.TotalCount);});}};u.addSiteSettingsPage=function(J,K){u.openCreatePageDialog(function(L){if(L.Data!=null){u.pagesGridViewModel.items.unshift(new v(L.Data));}});};u.siteSettingsSetBooleanTemplate=function(J,M){var L=(M===true)?a(C.siteSettingsPageBooleanTemplateTrue):a(C.siteSettingsPageBooleanTemplateFalse),K=a(L.html());J.html(K);};u.openEditPageDialog=function(J,L,M,K){x.openEditPageDialog(J,L,M,K);};u.editSiteSettingsPage=function(L){var K=L.id();var J=E.getModalDialog().container;u.openEditPageDialog(K,function(M){if(M.Data!=null){if(M.Data.IsArchived){var N=J.find(C.siteSettingsPagesListForm),O=N.find(C.siteSettingsPagesListFormFilterIncludeArchived);if(!O.is(":checked")){u.pagesGridViewModel.items.remove(L);return;}}s(M,L);}},L.title());};u.deleteSiteSettingsPage=function(K,J){u.deletePage(K.id(),function(L){u.pagesGridViewModel.items.remove(K);});};function e(M,L,J){var K;q.open({title:L,acceptTitle:j.cloneButtonTitle,onLoad:function(N){g.bindDialog(N,M,{contentAvailable:function(O,P){var V={accessControl:B.createUserAccessViewModel(P.Data.UserAccessList)},Q=N.container.find(C.clonePageForm),U=Q.find(C.languageSelection),T=function(){return c.pageId;},S=function(){return U!=null?U.val():null;},R=u.initializePermalinkBox(N,false,o.convertStringToSlugUrl,C.addNewPageTitleInput,true,T,S);if(U!=null){U.on("change",function(){R.Regenerate();});a(U[0]).select2({minimumResultsForSearch:-1});}if(Q.length>0){n.applyBindings(V,Q.get(0));}else{a(q.selectors.accept).hide();}if(a.isFunction(J)){J(O,P);}},beforePost:function(){if(!z){var O=N.container.find(C.editPermalinkEditField);K=O.val();O.val(null);}},postError:function(){if(!z){var O=N.container.find(C.editPermalinkEditField);O.val(K);}},postSuccess:function(O){if(O.Success&&O.Data&&(O.Data.Url||O.Data.PageUrl)){var P=function(Q){A.RedirectWithAlert(O.Data.Url||O.Data.PageUrl);};if(c.trigger(c.events.pageCreated,{Data:O.Data,Callback:P})<=0){if(P&&a.isFunction(P)){P(O.Data);}}}else{q.showMessages(O);}}});}});}u.clonePage=function(){var K=a.format(o.clonePageDialogUrl,c.pageId),J=j.clonePageDialogTitle;e(K,J);};u.translatePage=function(){var K=a.format(o.clonePageWithLanguageDialogUrl,c.pageId),J=j.clonePageWithLanguageDialogTitle;e(K,J,function(L){L.container.find(C.languageSelection).on("change",function(){var M=a(this);if(M.hasClass(d.inputValidationError)){M.removeClass(d.inputValidationError);}});L.container.find(C.cloneWithLanguageGoToPagePropertiesLink).on("click",function(){L.close();x.editPageProperties(function(M){M.container.find(C.pagePropertiesTranslationsTab).click();});});});};function l(){a.validator.addMethod("jqpageurlvalidation",function(M,J,L){if(z){if(!M){return false;}var K=new RegExp(L.pattern).exec(M);return(K&&(K.index===0)&&(K[0].length===M.length));}return true;},function(J){return J.message;});a.validator.unobtrusive.adapters.add("pageurlvalidation",["pattern"],function(J){J.rules.jqpageurlvalidation={message:J.message,pattern:J.params.pattern};});a.validator.addMethod("jqenddatevalidation",function(M,J,K){var L=a("#"+K.startdateproperty).val();if(M!=null&&M!=""&&L!=null&&L!=""){return f.parseDate(L)<=f.parseDate(M);}return true;},function(J){return J.message;});a.validator.unobtrusive.adapters.add("enddatevalidation",["startdateproperty"],function(J){J.rules.jqenddatevalidation={message:J.message,startdateproperty:J.params.startdateproperty};});}u.openPageSelectDialog=function(J,K){J=a.extend({onAccept:function(){return true;},onClose:function(){return true;},url:o.loadSelectPageUrl,params:{},canBeSelected:true,title:j.selectPageDialogTitle,disableAccept:false},J);var M=J.params?(J.url.indexOf("?")>0?J.url+"&"+a.param(J.params):J.url+"?"+a.param(J.params)):o.loadSelectPageUrl,L=q.open({title:J.title,acceptTitle:j.selectPageSelectButtonTitle,disableAccept:J.disableAccept,onClose:function(){var N=true;if(a.isFunction(J.onClose)){N=J.onClose();}return N;},onLoad:function(N){g.setContentFromUrl(N,M,{done:function(O){u.initializeSiteSettingsPagesList(O.Html,O.Data,a.extend({dialog:N,dialogContainer:L,canBeSelected:J.canBeSelected},K));}});},onAcceptClick:function(){var O=L.container.find(C.siteSettingsPagesTableActiveRow),N=O.find(C.siteSettingsPageEditButton).data("id"),P=O.find(C.siteSettingPageTitleCell);if(J.canBeSelected){if(O.length==0){q.info({content:j.pageNotSelectedMessage,disableCancel:true});return false;}}if(a.isFunction(J.onAccept)){return J.onAccept({Id:N,Title:P.html(),PageUrl:P.data("url"),LanguageId:P.data("languageId")});}return true;}});return L;};u.init=function(){c.logger.debug("Initializing bcms.pages module.");l();w.openPageSelectDialog=u.openPageSelectDialog;};c.registerInit(u.init);return u;});bettercms.define("bcms.pages.properties",["bcms.jquery","bcms","bcms.modal","bcms.forms","bcms.dynamicContent","bcms.tags","bcms.categories","bcms.ko.extenders","bcms.media","bcms.redirect","bcms.options","bcms.security","bcms.messages","bcms.codeEditor","bcms.pages.languages","bcms.store","bcms.htmlEditor"],function(a,b,s,k,j,B,c,o,q,x,t,y,r,e,v,A,m){var u={},z={editPagePropertiesCloseInfoMessageBox:".bcms-js-info-message",editPagePropertiesCloseInfoMessage:"#bcms-editpage-closeinfomessage",editPagePropertiesInfoMessageBox:".bcms-info-messages",editPermalink:"#bcms-pageproperties-editpermalink",editPermalinkBox:".bcms-js-edit-box",editPermalinkClose:"div.bcms-js-edit-box .bcms-tip-close, div.bcms-js-edit-box .bcms-btn-cancel",editPermalinkSave:"#bcms-save-permalink",permalinkHiddenField:"#bcms-page-permalink",permalinkEditField:"#bcms-page-permalink-edit",permalinkInfoField:"#bcms-page-permalink-info",pagePropertiesTemplateSelect:".bcms-js-grid-box",pagePropertiesTemplateId:"#TemplateId",pagePropertiesMasterPageId:"#MasterPageId",pagePropertiesCategoriesSelect:"#bcms-js-categories-select",pagePropertiesForceAccessProtocolSelect:"#ForceAccessProtocol",pagePropertiesForm:"form:first",pagePropertiesPageIsPublishedCheckbox:"#IsPagePublished",pagePropertiesPageIsMasterCheckbox:"#IsMasterPage",optionsTab:"#bcms-tab-3",translationsTabContent:"#bcms-tab-5 .bcms-page-translations-content",javascriptCssTabOpener:'.bcms-tab-item[data-name="#bcms-tab-4"]',codeEditorsContainer:".bcms-window-tabbed-options",codeEditorsTitles:".bcms-content-titles",codeEditorsParent:".bcms-input-list-holder"},p={loadEditPropertiesDialogUrl:null,loadLayoutOptionsUrl:null,loadLayoutUserAccessUrl:null,checkForMissingContentUrl:null},l={editPagePropertiesModalTitle:null,editMasterPagePropertiesModalTitle:null,pageStatusChangeConfirmationMessagePublish:null,pageStatusChangeConfirmationMessageUnPublish:null,pageConversionToMasterConfirmationMessage:null,selectedMasterIsChildPage:null,missingContentConfirmationMessage:null},n={editPagePropertiesInfoMessageClosed:"bcms.EditPagePropertiesInfoBoxClosed"},d={pagePropertiesActiveTemplateBox:"bcms-grid-box-active",inactive:"bcms-inactive"},g,f,i,h;u.links=p;u.globalization=l;function D(F){var E=this;E.id=F.TemplateId;E.previewUrl=F.PreviewUrl;E.previewThumbnailUrl=F.PreviewThumbnailUrl;E.title=F.Title;E.isActive=o.observable(F.IsActive);E.isCircularToCurrent=F.IsCircularToCurrent;E.isCompatible=F.IsCompatible;E.isMasterPage=F.IsMasterPage;E.select=function(){};E.previewImage=function(){s.imagePreview(E.previewUrl,E.title);};}function C(K,F,I,H){var J=this;J.templates=o.observableArray();J.displayedTemplates=o.observableArray();J.searchQuery=o.observable();J.searchEnabled=o.observable(false);J.hasFocus=o.observable(false);J.optionsContainer=I;J.optionListViewModel=H;J.dialog=F;for(var G=0;G<K.length;G++){var E=new D(K[G]);J.templates.push(E);}J.searchQuery.subscribe(function(){J.search();});J.displayTemplates=function(){if(J.templates()!=null){J.displayedTemplates.removeAll();var N=(J.searchQuery()||"").toLowerCase();for(var M=0;M<J.templates().length;M++){var L=J.templates()[M];if(N&&L.title.toLowerCase().indexOf(N)<0){continue;}J.displayedTemplates.push(L);}}};J.search=function(){J.displayTemplates();};J.toggleSearch=function(){if(!J.searchEnabled()){J.searchEnabled(true);J.hasFocus(true);}else{J.searchEnabled(false);J.searchQuery("");}};J.setActive=function(N){var L=J.findCurrentActive();if(L.id===N.id){return;}var M=r.box({container:F.container});M.clearMessages();if(N.isCircular){M.addWarningMessage(l.selectedMasterIsChildPage);return;}L.isActive(false);if(N.isMasterPage){F.container.find(z.pagePropertiesMasterPageId).val(N.id);F.container.find(z.pagePropertiesTemplateId).val("");}else{F.container.find(z.pagePropertiesTemplateId).val(N.id);F.container.find(z.pagePropertiesMasterPageId).val("");}N.isActive(true);u.loadLayoutOptions(N.id,N.isMasterPage,F.container,I,H);};J.findCurrentActive=function(){for(var L=0;L<J.templates().length;L++){if(J.templates()[L].isActive()){return J.templates()[L];}}return null;};J.displayTemplates();}function w(H,J,G,L,I,E,N,F,M){var K=this;K.tags=L;K.options=I;K.image=o.observable(new q.ImageSelectorViewModel(H));K.secondaryImage=o.observable(new q.ImageSelectorViewModel(J));K.featuredImage=o.observable(new q.ImageSelectorViewModel(G));K.accessControl=E;K.translations=N;K.categories=F;K.templatesList=M;}u.initEditPagePropertiesDialogEvents=function(I,H){var M=I.container.find(z.optionsTab),L=t.createOptionValuesViewModel(M,H.Data.OptionValues,H.Data.CustomOptions),O=new B.TagsListViewModel(H.Data.Tags),F=new c.CategoriesSelectListModel(H.Data.Categories,I.container),E=y.createUserAccessViewModel(H.Data.UserAccessList),Q=H.Data.Languages?new v.PageTranslationsListViewModel(H.Data.Translations,H.Data.Languages,H.Data.LanguageId,H.Data.PageId):null,P=new C(H.Data.Templates,I,M,L),N=new w(H.Data.Image,H.Data.SecondaryImage,H.Data.FeaturedImage,O,L,E,Q,F,P),J=I.container.find(z.pagePropertiesForm),G=false;c.initCategoriesSelect(F,H.Data.CategoriesLookupList,I.container);a(z.pagePropertiesForceAccessProtocolSelect).select2({minimumResultsForSearch:-1});o.applyBindings(N,J.get(0));g=I.container.find(z.pagePropertiesPageIsPublishedCheckbox).is(":checked");f=I.container.find(z.pagePropertiesPageIsMasterCheckbox).is(":checked");i=I.container.find(z.pagePropertiesTemplateId).val();h=I.container.find(z.pagePropertiesMasterPageId).val();I.container.find(z.editPermalink).on("click",function(){u.showPagePropertiesEditPermalinkBox(I);});I.container.find(z.editPermalinkClose).on("click",function(){u.closePagePropertiesEditPermalinkBox(I);});I.container.find(z.editPermalinkSave).on("click",function(){u.savePagePropertiesEditPermalinkBox(I);});J.on("submit",function(){if(!I.container.find(z.permalinkEditField).valid()){u.showPagePropertiesEditPermalinkBox(I);}});var K=A.get(n.editPagePropertiesInfoMessageClosed);if(K&&K==="1"){u.hideEditPagePropertiesInfoMessage(I);}else{I.container.find(z.editPagePropertiesCloseInfoMessageBox).on("click",function(){A.set(n.editPagePropertiesInfoMessageClosed,"1");u.hideEditPagePropertiesInfoMessage(I);});}I.container.find(z.editPagePropertiesCloseInfoMessage).on("click",function(){I.container.find(z.editPagePropertiesInfoMessageBox).hide();});b.preventInputFromSubmittingForm(I.container.find(z.permalinkEditField),{preventedEnter:function(){I.container.find(z.permalinkEditField).blur();u.savePagePropertiesEditPermalinkBox(I);},preventedEsc:function(){I.container.find(z.permalinkEditField).blur();u.closePagePropertiesEditPermalinkBox(I);}});I.container.find(z.javascriptCssTabOpener).on("click",function(){if(!G){var R={marginTop:30,topElements:[{element:z.codeEditorsTitles,takeMargins:true}],container:z.codeEditorsContainer,parent:z.codeEditorsParent,marginBottom:1};e.initialize(I.container,I,null,R);G=true;}});if(H.Data.ShowTranslationsTab&&(!H.Data.Languages||H.Data.Languages.length==0)){I.container.find(z.translationsTabContent).addClass(d.inactive);}return N;};u.loadLayoutOptions=function(E,F,G,J,I){var H=function(R){var L,Q,O=I.items,M,N,P=[],S;J.hideLoading();if(R.Messages&&R.Messages.length>0){r.refreshBox(G,R);}if(R.Success){for(L=0,S=O().length;L<S;L++){M=O()[L];if(M.useDefaultValue()===true&&M.canEditOption()===false){P.push(M);}else{M.defaultValue("");M.canEditOption(true);M.useDefaultValue(false);}}for(L=0,S=P.length;L<S;L++){M=P[L];O.remove(M);}for(L=0,S=R.Data.length;L<S;L++){N=false;for(Q=0;Q<O().length;Q++){M=O()[Q];if(M.key()==R.Data[L].OptionKey){var K=M.type()!=R.Data[L].Type&&M.customType()!=R.Data[L].CustomType;M.canEditOption(K);M.changeFieldsEditing();if(!K){M.defaultValue(R.Data[L].OptionDefaultValue);}N=true;break;}}if(N){continue;}M=I.createItem(R.Data[L]);I.items.push(M);}for(L=0,S=O().length;L<S;L++){M=O()[L];M.changeFieldsEditing();}}};J.showLoading();a.ajax({type:"GET",url:a.format(p.loadLayoutOptionsUrl,E,F)}).done(function(K){H(K);}).fail(function(K){H(b.parseFailedResponse(K));});};u.loadLayoutUserAccess=function(F,G,H,E){var I=function(J){if(J.Messages&&J.Messages.length>0){r.refreshBox(H,J);}if(J.Success){y.updateUserAccessViewModel(E,J.Data);}};a.ajax({type:"GET",url:a.format(p.loadLayoutUserAccessUrl,F,G)}).done(function(J){I(J);}).fail(function(J){I(b.parseFailedResponse(J));});};u.showPagePropertiesEditPermalinkBox=function(E){E.container.find(z.editPermalinkBox).show();E.container.find(z.permalinkEditField).focus();};u.savePagePropertiesEditPermalinkBox=function(E){if(a(z.permalinkEditField).valid()){var F=E.container.find(z.permalinkEditField).val();E.container.find(z.permalinkHiddenField).val(F);E.container.find(z.permalinkInfoField).html(F||"&nbsp;");u.hidePagePropertiesEditPermalinkBox(E);}};u.closePagePropertiesEditPermalinkBox=function(E){var G=E.container.find(z.permalinkHiddenField).val(),F=E.container.find(z.permalinkEditField);F.val(G);F.blur();u.hidePagePropertiesEditPermalinkBox(E);};u.hidePagePropertiesEditPermalinkBox=function(E){E.container.find(z.editPermalinkBox).hide();};u.hideEditPagePropertiesInfoMessage=function(E){E.container.find(z.editPagePropertiesCloseInfoMessageBox).hide();};u.openEditPageDialog=function(H,K,L,I){var J,E=y.IsAuthorized(["BcmsEditContent"]),F=y.IsAuthorized(["BcmsAdministration"]),G=y.IsAuthorized(["BcmsPublishContent"]);s.open({title:L||l.editPagePropertiesModalTitle,disableAccept:!E&&!G&&!F,onLoad:function(M){var N=a.format(p.loadEditPropertiesDialogUrl,H);j.bindDialog(M,N,{contentAvailable:function(O,P){var Q=M.container.find(z.pagePropertiesForm),R,S;if(Q.data("readonly")!==true&&G&&!E&&!F){Q.data("readonlyWithPublishing",true);Q.addClass(d.inactive);k.setFieldsReadOnly(Q);R=Q.find(z.pagePropertiesPageIsPublishedCheckbox);S=R.parents(".bcms-input-list-holder:first");R.removeAttr("readonly");S.find('input[type="checkbox"]').attr("disabled","disabled");R.removeAttr("disabled");S.css("z-index",100);}J=u.initEditPagePropertiesDialogEvents(O,P);if(P.Data&&P.Data.IsMasterPage===true){O.setTitle(l.editMasterPagePropertiesModalTitle);}if(a.isFunction(I)){I(O,P);}},beforePost:function(){if(!M.container.find(z.permalinkEditField).valid()){u.showAddNewPageEditPermalinkBox(M);return false;}if(!J.options.isValid(true)){return false;}var R=M.container.find(z.pagePropertiesPageIsPublishedCheckbox).is(":checked"),Q=R?l.pageStatusChangeConfirmationMessagePublish:l.pageStatusChangeConfirmationMessageUnPublish,P=M.container.find(z.pagePropertiesPageIsMasterCheckbox).is(":checked"),T=M.container.find(z.pagePropertiesTemplateId).val(),S=M.container.find(z.pagePropertiesMasterPageId).val();if(S!=h||T!=i){var O=false;a.ajax({type:"GET",url:a.format(p.checkForMissingContentUrl,H,T,S),async:false}).done(function(U){if(U.Data){O=U.Data.IsMissingContents;}});if(O){s.confirm({content:l.missingContentConfirmationMessage,onAccept:function(){h=S;i=T;M.container.find(z.pagePropertiesForm).submit();}});return false;}}if(f!=P){s.confirm({content:l.pageConversionToMasterConfirmationMessage,onAccept:function(){if(g!=R){g=R;}f=P;M.container.find(z.pagePropertiesForm).submit();}});return false;}if(g!=R){s.confirm({content:Q,onAccept:function(){g=R;M.container.find(z.pagePropertiesForm).submit();}});return false;}return true;},postSuccess:K});},onAccept:function(){m.destroyAllHtmlEditorInstances();},onClose:function(){m.destroyAllHtmlEditorInstances();}});};u.editPageProperties=function(E){u.openEditPageDialog(b.pageId,function(F){if(F.Data&&F.Data.PageUrl){x.RedirectWithAlert(F.Data.PageUrl);}},l.editPagePropertiesModalTitle,E);};u.editMasterPageProperties=function(){u.openEditPageDialog(b.pageId,function(E){if(E.Data&&E.Data.PageUrl){x.RedirectWithAlert(E.Data.PageUrl);}},l.editMasterPagePropertiesModalTitle);};u.init=function(){b.logger.debug("Initializing bcms.pages.properties module.");};b.registerInit(u.init);return u;});bettercms.define("bcms.pages.redirects",["bcms.jquery","bcms","bcms.dynamicContent","bcms.siteSettings","bcms.inlineEdit","bcms.grid"],function(a,b,c,j,d,f){var h={},i={redirectsForm:"#bcms-redirects-form",searchLink:"#bcms-redirects-search-btn",searchField:"#SearchQuery",createLink:"#bcms-create-redirect-button",deleteLink:".bcms-grid-item-delete-button",pageUrlEditor:"input.bcms-page-url",redirectUrlEditor:"input.bcms-redirect-url",pageUrl:"a.bcms-page-url",redirectUrl:"a.bcms-redirect-url",oldPageUrl:"input.bcms-old-page-url",oldRedirectUrl:"input.bcms-old-redirect-url"},g={loadSiteSettingsRedirectListUrl:null,deleteRedirectUrl:null,saveRedirectUrl:null},e={deleteRedirectMessage:null};h.links=g;h.globalization=e;h.loadSiteSettingsRedirectList=function(){c.bindSiteSettings(j,h.links.loadSiteSettingsRedirectListUrl,{contentAvailable:h.initializeSiteSettingsRedirectsList});};h.initializeSiteSettingsRedirectsList=function(l,o){var m=j.getModalDialog(),k=m.container;var n=m.container.find(i.redirectsForm);f.bindGridForm(n,function(p){j.setContent(p);h.initializeSiteSettingsRedirectsList(p);});n.on("submit",function(p){p.preventDefault();h.searchSiteSettingsRedirects(n,k);return false;});n.find(i.searchLink).on("click",function(){var p=a(this).parent();if(!p.hasClass("bcms-active-search")){n.find(i.searchField).prop("disabled",false);p.addClass("bcms-active-search");n.find(i.searchField).focus();}else{n.find(i.searchField).prop("disabled",true);p.removeClass("bcms-active-search");n.find(i.searchField).val("");}});n.find(i.createLink).on("click",function(){d.addNewRow(k);});if(o===true){n.find(i.searchLink).parent().addClass("bcms-active-search");}else{n.find(i.searchField).prop("disabled",true);}d.initialize(k,{saveUrl:g.saveRedirectUrl,deleteUrl:g.deleteRedirectUrl,onSaveSuccess:h.setRedirectFields,rowDataExtractor:h.getRedirectData,deleteRowMessageExtractor:function(){return e.deleteRedirectMessage;}});m.setFocus();};h.searchSiteSettingsRedirects=function(l,k){f.submitGridForm(l,function(m){j.setContent(m);h.initializeSiteSettingsRedirectsList(m,true);var n=k.find(i.searchField);f.focusSearchInput(n);});};h.setRedirectFields=function(l,k){if(k.Data){l.find(i.pageUrl).html(k.Data.PageUrl);l.find(i.pageUrlEditor).val(k.Data.PageUrl);l.find(i.oldPageUrl).val(k.Data.PageUrl);l.find(i.redirectUrl).html(k.Data.RedirectUrl);l.find(i.redirectUrlEditor).val(k.Data.RedirectUrl);l.find(i.oldRedirectUrl).val(k.Data.RedirectUrl);}};h.getRedirectData=function(m){var n=m.find(i.deleteLink).data("id"),o=m.find(i.deleteLink).data("version"),k=m.find(i.pageUrlEditor).val(),l=m.find(i.redirectUrlEditor).val();return{Id:n,Version:o,PageUrl:k,RedirectUrl:l};};h.init=function(){b.logger.debug("Initializing bcms.pages.redirects module.");};b.registerInit(h.init);return h;});bettercms.define("bcms.pages.seo",["bcms.jquery","bcms","bcms.modal","bcms.messages","bcms.dynamicContent","bcms.redirect"],function(a,b,h,g,d,i){var k={},c={editSeoDialogClass:"bcms-modal-edit-seo"},j={pageUrlPath:"#bcms-page-permalink-info",editPageUrlLink:"#bcms-editseo-editurlpath",editUrlPathBox:".bcms-js-edit-box",editUrlSave:"#bcms-editseo-editurlpath-save",editUrlCancel:"#bcms-editseo-editurlpath-cancel, .bcms-js-edit-box .bcms-tip-close",editUrlTextBox:".bcms-js-url-path",editSeoForm:"form:first",editSeoCloseInfoMessage:"#bcms-seo-closeinfomessage",editSeoInfoMessageBox:".bcms-warning-messages"},f={loadEditSeoDialogUrl:null},e={editSeoDialogTitle:null};k.links=f;k.globalization=e;function l(m,n){if(n){m.container.find(j.editUrlPathBox).show();m.container.find(j.editUrlTextBox).focus();}else{m.container.find(j.editUrlTextBox).blur();m.container.find(j.editUrlPathBox).hide();}}k.initEditSeoDialogEvents=function(m){m.container.find(j.editPageUrlLink).on("click",function(){l(m,true);});m.container.find(j.editUrlSave).on("click",function(){k.saveEditUrlPath(m);});m.container.find(j.editUrlCancel).on("click",function(){k.cancelEditUrlPath(m);});m.container.find(j.editSeoCloseInfoMessage).on("click",function(){m.container.find(j.editSeoInfoMessageBox).hide();});m.container.find(j.editSeoForm).on("submit",function(){if(!m.container.find(j.editUrlTextBox).valid()){l(m,true);}});b.preventInputFromSubmittingForm(m.container.find(j.editUrlTextBox),{preventedEnter:function(){m.container.find(j.editUrlTextBox).blur();k.saveEditUrlPath(m);},preventedEsc:function(){m.container.find(j.editUrlTextBox).blur();k.cancelEditUrlPath(m);}});};k.saveEditUrlPath=function(m){var n=m.container.find(j.editUrlTextBox),o=true;if(a.isFunction(n.valid)){o=n.valid();}if(o){m.container.find(j.pageUrlPath).text(n.val());l(m,false);}};k.cancelEditUrlPath=function(m){var n=m.container.find(j.pageUrlPath).text();m.container.find(j.editUrlTextBox).val(n);l(m,false);};k.openEditSeoDialog=function(){h.open({title:e.editSeoDialogTitle,cssClass:c.editSeoDialogClass,onLoad:function(m){var n=a.format(f.loadEditSeoDialogUrl,b.pageId);d.bindDialog(m,n,{contentAvailable:function(){k.initEditSeoDialogEvents(m);},postComplete:function(o){if(o.Data&&o.Data.PageUrlPath){i.RedirectWithAlert(o.Data.PageUrlPath);}}});}});};k.init=function(){b.logger.debug("Initializing bcms.pages.seo module.");};b.registerInit(k.init);return k;});bettercms.define("bcms.pages.sitemap",["bcms.jquery","bcms","bcms.modal","bcms.siteSettings","bcms.forms","bcms.dynamicContent","bcms.messages","bcms.ko.extenders","bcms.grid","bcms.security","bcms.tags","bcms.antiXss"],function(a,i,A,N,q,n,z,w,s,J,S,h){var L={},K={sitemapAddNodeDataBind:"#bcms-sitemap-addnode",sitemapAddNewPageDataBind:"#bcms-sitemap-addnewpage",sitemapForm:".bcms-sitemap-form",scrollDiv:"#bcms-scroll-window",searchField:".bcms-search-query",searchButton:"#bcms-sitemaps-search-btn",siteSettingsSitemapsForm:"#bcms-sitemaps-form",siteSettingsSitemapCreateButton:"#bcms-create-sitemap-button",siteSettingsSitemapTitleCell:".bcms-sitemap-title",siteSettingsSitemapRow:"tr",siteSettingsRowCells:"td",siteSettingsSitemapParentRow:"tr:first",siteSettingsSitemapEditButton:".bcms-grid-item-edit-button",siteSettingsSitemapHistoryButton:".bcms-grid-item-history-button",siteSettingsSitemapDeleteButton:".bcms-grid-item-delete-button",siteSettingsSitemapRowTemplate:"#bcms-sitemap-list-row-template",siteSettingsSitemapRowTemplateFirstRow:"tr:first",siteSettingsSitemapsTableFirstRow:"table.bcms-tables > tbody > tr:first",siteSettingsSitemapsLoaderContainer:".bcms-window-tabbed-options",gridRestoreLinks:"#bcms-sitemaphistory-form tr .bcms-js-restore",gridCells:"#bcms-sitemaphistory-form tr td",gridRowPreviewLink:".bcms-js-preview:first",firstRow:"tr:first",gridRows:"#bcms-sitemaphistory-form tr",versionPreviewContainer:"#bcms-history-preview",versionPreviewLoaderContainer:".bcms-history-preview",sitemapHistoryForm:"#bcms-sitemaphistory-form",sitemapHistorySearchButton:".bcms-btn-search",modalContent:".bcms-modal-content",firstTab:"#bcms-tab-1",secondTab:"#bcms-tab-2",secondTabButton:'.bcms-tab-item[data-name="#bcms-tab-2"]',leftColumn:".bcms-leftcol",tabsSlider:".bcms-js-tab-header:first",tabsSliderLeftArrow:".bcms-sitemaps-arrow-left",tabsSliderRightArrow:".bcms-sitemaps-arrow-right",languageSelector:".bcms-global-select"},y={loadSiteSettingsSitemapsListUrl:null,saveSitemapUrl:null,saveSitemapNodeUrl:null,deleteSitemapUrl:null,deleteSitemapNodeUrl:null,sitemapEditDialogUrl:null,sitemapAddNewPageDialogUrl:null,saveMultipleSitemapsUrl:null,sitemapHistoryDialogUrl:null,loadSitemapVersionPreviewUrl:null,restoreSitemapVersionUrl:null,getPageTranslations:null},r={sitemapCreatorDialogTitle:null,sitemapEditorDialogTitle:null,sitemapEditorDialogCustomLinkTitle:null,sitemapAddNewPageDialogTitle:null,sitemapDeleteNodeConfirmationMessage:null,sitemapDeleteConfirmMessage:null,sitemapSomeNodesAreInEditingState:null,sitemapNodeSaveButton:null,sitemapNodeOkButton:null,sitemapPlaceLinkHere:null,sitemapIsEmpty:null,sitemapHistoryDialogTitle:null,sitemapVersionRestoreConfirmation:null,restoreButtonTitle:null,closeButtonTitle:null,invariantLanguage:null},j={tableActiveRow:"bcms-table-row-active"},p={sitemapNodeAdded:"sitemapNodeAdded",sitemapNodeRemoved:"sitemapNodeRemoved",sitemapNodeTranslationsUpdated:"sitemapNodeTranslationsUpdated"},k="00000000-0000-0000-0000-000000000000",m={None:"none",EmptyListZone:"emptyListZone",TopZone:"topZone",MiddleZone:"middleZone",BottomZone:"bottomZone"},B=0,O=0;L.links=y;L.globalization=r;L.activeMapModel=null;L.activeLoadingContainer=null;L.activeMessageContainer=null;L.events=p;L.loadSiteSettingsSitemapList=function(){n.bindSiteSettings(N,y.loadSiteSettingsSitemapsListUrl,{contentAvailable:L.initializeSitemapsList});};L.initializeSitemapsList=function(ab){var Z=N.getModalDialog(),Y=Z.container,aa=Y.find(K.siteSettingsSitemapsForm);s.bindGridForm(aa,function(ac){N.setContent(ac);L.initializeSitemapsList();});aa.on("submit",function(ac){i.stopEventPropagation(ac);I(aa);return false;});i.preventInputFromSubmittingForm(aa.find(K.searchField),{preventedEnter:function(){I(aa);}});aa.find(K.searchButton).on("click",function(ac){var ad=a(this).parent();if(!ad.hasClass("bcms-active-search")){aa.find(K.searchField).prop("disabled",false);ad.addClass("bcms-active-search");aa.find(K.searchField).focus();}else{aa.find(K.searchField).prop("disabled",true);ad.removeClass("bcms-active-search");aa.find(K.searchField).val("");}});if(ab===true){aa.find(K.searchButton).parent().addClass("bcms-active-search");}else{aa.find(K.searchField).prop("disabled",true);}t(Y);s.focusSearchInput(Y.find(K.searchField),true);};function I(Y){s.submitGridForm(Y,function(Z){N.setContent(Z);L.initializeSitemapsList(true);});}function t(Y,Z){Y.find(K.siteSettingsSitemapCreateButton).on("click",function(aa){i.stopEventPropagation(aa);g(Z||Y);});Y.find(K.siteSettingsRowCells).on("click",function(ab){i.stopEventPropagation(ab);var aa=a(this).parents(K.siteSettingsSitemapRow).find(K.siteSettingsSitemapEditButton);if(aa.length>0){o(aa,Z||Y);}});Y.find(K.siteSettingsSitemapHistoryButton).on("click",function(aa){i.stopEventPropagation(aa);X(a(this),Z||Y);});Y.find(K.siteSettingsSitemapDeleteButton).on("click",function(aa){i.stopEventPropagation(aa);l(a(this),Z||Y);});}function g(Y){L.openCreateSitemapDialog(function(Z){if(Z.Data!=null){var ab=a(K.siteSettingsSitemapRowTemplate),aa=a(ab.html()).find(K.siteSettingsSitemapRowTemplateFirstRow);aa.find(K.siteSettingsSitemapTitleCell).html(h.encodeHtml(Z.Data.Title));aa.find(K.siteSettingsSitemapEditButton).data("id",Z.Data.Id);aa.find(K.siteSettingsSitemapHistoryButton).data("id",Z.Data.Id);aa.find(K.siteSettingsSitemapDeleteButton).data("id",Z.Data.Id);aa.find(K.siteSettingsSitemapDeleteButton).data("version",Z.Data.Version);aa.insertBefore(a(K.siteSettingsSitemapsTableFirstRow,Y));t(aa,Y);s.showHideEmptyRow(Y);}},true);}function o(aa,Y){var Z=aa.data("id");L.loadAddNodeDialog(Z,function(ac){if(ac.Data!=null){var ad=aa.parents(K.siteSettingsSitemapParentRow),ab=ad.find(K.siteSettingsSitemapTitleCell);ab.html(h.encodeHtml(ac.Data.Title));ad.find(K.siteSettingsSitemapDeleteButton).data("version",ac.Data.Version);}},r.sitemapEditorDialogTitle);}function X(aa,Y){var Z=aa.data("id");L.showSitemapHistoryDialog(Z,function(ac){if(ac.Data!=null){var ad=aa.parents(K.siteSettingsSitemapParentRow),ab=ad.find(K.siteSettingsSitemapTitleCell);ab.html(h.encodeHtml(ac.Data.Title));ad.find(K.siteSettingsSitemapDeleteButton).data("version",ac.Data.Version);}},r.sitemapHistoryDialogTitle);}function l(aa,Y){var Z=aa.data("id"),ab=aa.data("version");L.deleteSitemap(Z,ab,function(ac){z.refreshBox(K.siteSettingsSitemapsForm,ac);if(ac.Success){aa.parents(K.siteSettingsSitemapParentRow).remove();s.showHideEmptyRow(Y);}});}L.openCreateSitemapDialog=function(Y){L.loadAddNodeDialog(k,Y,r.sitemapCreatorDialogTitle);};L.loadAddNodeDialog=function(aa,ab,Z){var Y=new f();A.open({title:Z||r.sitemapEditorDialogTitle,onLoad:function(ac){n.setContentFromUrl(ac,a.format(y.sitemapEditDialogUrl,aa),{done:function(ad){Y.initialize(ad,ac);}});},onAccept:function(ad){var ac=q.valid(ad.container.find(K.sitemapForm));if(ac){Y.save(function(ae){if(ae.Success){ad.close();if(ab&&a.isFunction(ab)){ab(ae);}z.refreshBox(K.siteSettingsSitemapsForm,ae);}else{L.showMessage(ae);}});}return false;}});};L.showSitemapHistoryDialog=function(aa,Y,Z){A.open({title:Z||r.sitemapHistoryDialogTitle,cancelTitle:r.closeButtonTitle,disableAccept:true,onLoad:function(ab){n.bindDialog(ab,a.format(y.sitemapHistoryDialogUrl,aa),{contentAvailable:function(){v(ab,Y);},beforePost:function(){ab.container.showLoading();},postComplete:function(){ab.container.hideLoading();}});},});};L.deleteSitemap=function(Z,ac,Y){var ab=a.format(y.deleteSitemapUrl,Z,ac),aa=function(ad){if(a.isFunction(Y)){Y(ad);}};A.confirm({content:r.sitemapDeleteConfirmMessage,onAccept:function(){a.ajax({type:"POST",url:ab,contentType:"application/json; charset=utf-8",dataType:"json",cache:false}).done(function(ad){aa(ad);}).fail(function(ad){aa(i.parseFailedResponse(ad));});}});};L.loadAddNewPageDialog=function(Z){if(Z&&Z.Data&&(Z.Data.IsSitemapActionEnabled!==false)&&(Z.Data.Title||Z.Data.PageTitle)&&(Z.Data.Url||Z.Data.PageUrl)&&(Z.Data.Id||Z.Data.PageId)&&!Z.Data.IsMasterPage){var Y=new d(Z.Data.Title||Z.Data.PageTitle,Z.Data.Url||Z.Data.PageUrl,Z.Data.Id||Z.Data.PageId,Z.Data.LanguageId||Z.Data.PageLanguageId);A.open({title:r.sitemapAddNewPageDialogTitle,onLoad:function(aa){n.setContentFromUrl(aa,y.sitemapAddNewPageDialogUrl,{done:function(ab){Y.initialize(ab,aa);}});},onAccept:function(aa){Y.save(function(){aa.close();});return false;},onClose:function(){if(Z.Callback&&a.isFunction(Z.Callback)){Z.Callback(Z);}}});}else{if(Z.Callback&&a.isFunction(Z.Callback)){Z.Callback(Z);}}};function f(){var Y=this;Y.container=null;Y.pageLinksModel=null;Y.initialize=function(Z,ab){Y.container=ab.container;L.activeMessageContainer=Y.container;L.activeLoadingContainer=Y.container.find(K.siteSettingsSitemapsLoaderContainer);if(Z.Success){var ad=new M(Z.Data.Sitemap),ac=Z.Data.Sitemap.IsReadOnly;if(!ac){L.showMessage(Z);}else{ab.container.find(A.selectors.readonly).removeClass(A.classes.inactive);ab.container.find(K.firstTab).addClass(A.classes.inactive);}ad.parseJsonNodes(Z.Data.Sitemap.RootNodes);Y.pageLinksModel=new G(ad,ab.container);Y.pageLinksModel.parseJsonLinks(Z.Data.PageLinks);L.activeMapModel=ad;ad.settings.canEditNode=!ac;ad.settings.canDeleteNode=!ac;ad.settings.canDragNode=!ac;ad.settings.canDropNode=!ac;ad.settings.nodeSaveButtonTitle=r.sitemapNodeOkButton;ad.settings.nodeSaveAfterUpdate=false;var aa=Y.container.find(K.sitemapAddNodeDataBind).get(0);if(aa){w.applyBindings(Y.pageLinksModel,aa);V();}}else{L.showMessage(Z);}};Y.save=function(Z){if(L.activeMapModel){L.activeMapModel.save(Z);}};}function d(ab,ac,Z,Y){var aa=this;aa.container=null;aa.newPageModel=null;aa.tabsModel=null;aa.initialize=function(ad,af){if(!(ad!=null&&ad.Data!=null&&ad.Data.length>0)){af.close();return;}aa.container=af.container;L.activeMessageContainer=aa.container;L.activeLoadingContainer=aa.container.find(K.sitemapAddNewPageDataBind);L.showMessage(ad);if(ad.Success){var am=[],ai=function(){af.close();};O=0;for(var ag=0;ag<ad.Data.length;ag++){var ak=new M(ad.Data[ag]),aj=new D(ab,ac,Z,Y),ah=new e(ak,aj,ai),al=new P(ah);am.push(al);ak.parseJsonNodes(ad.Data[ag].RootNodes,true);ak.settings.canEditNode=false;ak.settings.canDeleteNode=false;ak.settings.canDragNode=false;ak.settings.canDropNode=true;ak.settings.nodeSaveButtonTitle=r.sitemapNodeSaveButton;ak.settings.nodeSaveAfterUpdate=false;}aa.tabsModel=new Q(am,aa.container);var ae=aa.container.find(K.sitemapAddNewPageDataBind).parent().get(0);if(ae){w.applyBindings(aa.tabsModel,ae);V();}aa.tabsModel.slider.initialize();}};aa.save=function(ae){var ah=aa.tabsModel.tabs(),ag=[],af=function(ai){z.refreshBox(L.activeMessageContainer,ai);L.showLoading(false);if(ai.Success){if(ae&&a.isFunction(ae)){if(ai.Data==null){ai.Data={Title:ab,PageUrl:ac,PageId:Z};}ae(ai);}}};for(var ad=0;ad<ah.length;ad++){if(ah[ad].newPageViewModel.linkIsDropped()){ag.push(ah[ad].newPageViewModel.sitemap.getModelToSave());}}if(ag.length>0){a.ajax({url:y.saveMultipleSitemapsUrl,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",cache:false,data:JSON.stringify(ag),beforeSend:function(){L.showLoading(true);}}).done(function(ai){af(ai);}).fail(function(ai){af(i.parseFailedResponse(ai));});}};}L.showMessage=function(Y){z.refreshBox(L.activeMessageContainer,Y);};L.showLoading=function(Y){if(Y){a(L.activeLoadingContainer).showLoading();}else{a(L.activeLoadingContainer).hideLoading();}};function b(){w.bindingHandlers.draggable={init:function(aa,ac,Y,ad){var Z=ad,ab={revert:true,revertDuration:0,refreshPositions:true,scroll:true,containment:a(a(K.sitemapAddNodeDataBind).get(0)||a(K.sitemapAddNewPageDataBind).get(0)).find(K.scrollDiv).get(0),appendTo:a(a(K.sitemapAddNodeDataBind).get(0)||a(K.sitemapAddNewPageDataBind).get(0)).find(K.scrollDiv).get(0),helper:function(){if(Z.isExpanded){Z.isExpanded(false);}if(Z.isBeingDragged){Z.isBeingDragged(true);}return a(this).clone().width(a(this).width()).css({zIndex:9999});},start:function(){a(this).hide();},stop:function(ae,af){af.helper.remove();a(this).show();if(Z.isBeingDragged){Z.isBeingDragged(false);}}};if(!Z.superDraggable()&&Z.getSitemap&&!Z.getSitemap().settings.canDragNode){return;}a(aa).draggable(ab).data("dragObject",Z);}};}function c(){w.bindingHandlers.droppable={init:function(ab,ad,Y,ae){var Z=ae,aa=ad(),ac={tolerance:"pointer",over:function(){Z.activeZone(aa);},out:function(){Z.activeZone(m.None);},drop:function(ag,al){var ah=a(al.draggable).data("draggable"),af=a(al.draggable).data("dragObject"),ak=af;al.helper.remove();if(af.parentNode&&af.parentNode()){af.parentNode().childNodes.remove(af);}else{var aj=new C();aj.title(af.title());aj.url(af.url());aj.pageId(af.pageId());aj.pageTitle(af.title());aj.usePageTitleAsNodeTitle(af.pageId()!=null&&af.pageId()!=k?true:false);if(aa==m.EmptyListZone||aa==m.MiddleZone){aj.parentNode(Z);}else{aj.parentNode(Z.parentNode());}if(af.isCustom()){aj.dropOnCancel=true;aj.startEditSitemapNode();aj.callbackAfterSuccessSaving=function(){L.activeMapModel.updateNodesOrderAndParent();};aj.callbackAfterFailSaving=function(am){am.parentNode().childNodes.remove(am);i.trigger(p.sitemapNodeRemoved,self);};}if(L.activeMapModel.showLanguages()){aj.updateLanguageOnDropNewNode(af.languageId(),L.activeMapModel.languageId());}aj.superDraggable(af.superDraggable());af=aj;}af.isBeingDragged(false);af.displayOrder(0);var ai;if(aa==m.EmptyListZone){Z.childNodes.splice(0,0,af);}else{if(aa==m.TopZone){ai=a.inArray(Z,Z.parentNode().childNodes());Z.parentNode().childNodes.splice(ai,0,af);}else{if(aa==m.MiddleZone){Z.childNodes.splice(0,0,af);Z.isExpanded(true);}else{if(aa==m.BottomZone){ai=a.inArray(Z,Z.parentNode().childNodes());Z.parentNode().childNodes.splice(ai+1,0,af);}}}}Z.activeZone(m.None);L.activeMapModel.updateNodesOrderAndParent();a(al.draggable).data("draggable",ah);if(ak.dropped&&a.isFunction(ak.dropped)){ak.dropped(af);}V();i.trigger(p.sitemapNodeAdded,af);}};if(Z.getSitemap&&!Z.getSitemap().settings.canDropNode){return;}a(ab).droppable(ac);}};}function U(ac){var Y=null,aa=null;for(var Z=0;Z<ac.length;Z++){var ab=ac[Z];if(!ab.isDeleted()&&!ab.isBeingDragged()){if(Y==null){Y=ab;}aa=ab;}ab.isFirstNode(false);ab.isLastNode(false);}if(Y!=null){Y.isFirstNode(true);}if(aa!=null){aa.isLastNode(true);}}function V(){var Y=a(K.sitemapForm);i.updateFormValidator(Y);}function M(Y){var Z=this;Z.id=function(){return Y.Id;};Z.childNodes=w.observableArray([]);Z.childNodes.subscribe(U);Z.someNodeIsOver=w.observable(false);Z.activeZone=w.observable(m.None);Z.showHasNoDataMessage=w.observable(false);Z.allNodesExpanded=w.observable(false);Z.savingInProgress=false;Z.version=Y.Version;Z.title=w.observable(Y.Title);Z.tags=new S.TagsListViewModel(Y.Tags);Z.accessControl=J.createUserAccessViewModel(Y.UserAccessList);Z.languageId=w.observable("");Z.onLanguageChanged=function(aa){if(aa!=Z.languageId()){Z.languageId(aa);Z.changeLanguageForNodes(Z.childNodes());i.logger.debug('In sitemap language switched to "'+aa+'".');}};Z.changeLanguageForNodes=function(ac){for(var aa=0;aa<ac.length;aa++){var ab=ac[aa];ab.activateTranslation(Z.languageId());Z.changeLanguageForNodes(ab.childNodes());}};Z.showMacros=w.observable(Y.ShowMacros);Z.showLanguages=w.observable(Y.ShowLanguages);Z.language=Y.ShowLanguages?new x(Y.Languages,null,Z.onLanguageChanged):null,Z.settings={canEditNode:false,canDeleteNode:false,canDragNode:false,canDropNode:false,nodeSaveButtonTitle:r.sitemapNodeOkButton,nodeSaveAfterUpdate:false};Z.getSitemap=function(){return Z;};Z.getNoDataMessage=function(){if(Z.settings.canDeleteNode||Z.settings.canDropNode){return r.sitemapPlaceLinkHere;}return r.sitemapIsEmpty;};Z.checkIfAllNodesExpanded=function(ac){for(var aa=0;aa<ac.length;aa++){var ab=ac[aa];if(ab.hasChildNodes()){if(!ab.isExpanded()||!Z.checkIfAllNodesExpanded(ab.childNodes())){return false;}}}return true;};Z.callExpandOrCollapse=function(){var aa=!Z.allNodesExpanded();Z.expandOrCollapse(Z.childNodes(),aa);Z.allNodesExpanded(aa);};Z.expandOrCollapse=function(ad,aa){for(var ab=0;ab<ad.length;ab++){var ac=ad[ab];ac.isExpanded(aa);Z.expandOrCollapse(ac.childNodes(),aa);}};Z.toggleNodeExpand=function(aa){aa.toggleExpand();Z.allNodesExpanded(Z.checkIfAllNodesExpanded(Z.childNodes()));};Z.hasChildNodes=function(){var ab=Z.childNodes();for(var aa=0;aa<ab.length;aa++){if(!ab[aa].isDeleted()){return true;}}return false;};i.on(p.sitemapNodeAdded,function(){Z.allNodesExpanded(Z.checkIfAllNodesExpanded(Z.childNodes()));});Z.updateNodesOrderAndParent=function(){Z.updateNodes(Z.childNodes(),Z);};Z.updateNodes=function(aj,al){if(aj.length===0){return;}for(var aa=0;aa<aj.length;aa++){Z.updateNodes(aj[aa].childNodes(),aj[aa]);}var ab=false,an=0,ao=-1,ae=5000+aj.length*50;for(var ac=0;ac<aj.length;ac++){if(ac==0&&aj[ac].displayOrder()>0&&aj[ac].displayOrder()<100){ab=true;break;}if(ac==1&&aj[ac-1].displayOrder()==0&&aj[ac].displayOrder()<10){ab=true;break;}if(aj[ac].displayOrder()>ae){ab=true;break;}if(aj[ac].displayOrder()==0){an++;ao=ac;if(an>1){ab=true;break;}}}if(!ab){if(an==0){return;}ab=true;var ak=aj[ao],am=aj[ao-1],ag=aj[ao+1];if(ak!=null){if(am==null&&ag!=null){if(ag.displayOrder()-50>0){Z.updateNode(ak,ag.displayOrder()-50,al);return;}}if(am!=null&&ag==null){if(am.displayOrder()+50<2147483647){Z.updateNode(ak,am.displayOrder()+50,al);return;}}if(am!=null&&ag!=null){var af=Math.ceil((ag.displayOrder()-am.displayOrder())/2)+am.displayOrder();if(am.displayOrder()<af&&af<ag.displayOrder()){Z.updateNode(ak,af,al);return;}}}}if(ab){for(var ad=0;ad<aj.length;ad++){var ai=aj[ad],ah=ad==0?5000:aj[ad-1].displayOrder()+50;Z.updateNode(ai,ah,al);}}};Z.updateNode=function(aa,ab,ac){var ad=false;if(aa.displayOrder()!=ab){ad=true;aa.displayOrder(ab);}if(aa.parentNode()!=ac){ad=true;aa.parentNode(ac);}if(ad||aa.id()==k){aa.saveSitemapNode();}};Z.focusOnActiveNode=function(ab){for(var aa=0;aa<ab.length;aa++){if(ab[aa].isActive()){a(a("input","#"+ab[aa].containerId).get(0)).focus();return true;}if(Z.focusOnActiveNode(ab[aa].childNodes())){ab[aa].isExpanded(true);return true;}}return false;};Z.save=function(ac){if(Z.focusOnActiveNode(Z.childNodes())){var ab=z.box({container:L.activeMessageContainer});ab.clearMessages();ab.addWarningMessage(r.sitemapSomeNodesAreInEditingState);return;}var aa=JSON.stringify(Z.getModelToSave()),ad=function(ae){z.refreshBox(L.activeMessageContainer,ae);L.showLoading(false);if(ae.Success){if(ac&&a.isFunction(ac)){if(ae.Data==null){ae.Data={Title:Z.title()};}ac(ae);}}Z.savingInProgress=false;};if(!Z.savingInProgress){Z.savingInProgress=true;a.ajax({url:y.saveSitemapUrl,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",cache:false,data:aa,beforeSend:function(){L.showLoading(true);}}).done(function(ae){ad(ae);}).fail(function(ae){ad(i.parseFailedResponse(ae));});}};Z.parseJsonNodes=function(ac,aa){var ae=[];ac=ac||[];for(var ab=0;ab<ac.length;ab++){var ad=new C(aa);ad.fromJson(ac[ab],Z.showLanguages,aa);ad.parentNode(Z);ae.push(ad);}Z.childNodes(ae);};Z.composeJsonNodes=function(){return Z.nodesToJson(Z.childNodes());};Z.nodesToJson=function(ab){var ad=[];for(var aa=0;aa<ab.length;aa++){var ac=ab[aa].toJson();ac.ChildNodes=Z.nodesToJson(ab[aa].childNodes());ad.push(ac);}return ad;};Z.getModelToSave=function(){var ac=[],ad=Z.tags.items(),ae=[],aa=Z.accessControl.UserAccessList(),ab;for(ab=0;ab<ad.length;ab++){ac.push(ad[ab].name());}for(ab=0;ab<aa.length;ab++){ae.push({Identity:aa[ab].Identity(),AccessLevel:aa[ab].AccessLevel(),IsForRole:aa[ab].IsForRole(),});}return{Id:Z.id(),Version:Z.version,Title:Z.title(),RootNodes:Z.composeJsonNodes(),Tags:ac,UserAccessList:ae};};}function C(Y){var Z=this;Z.id=w.observable(k);Z.version=w.observable(0);Z.title=w.observable();Z.macro=w.observable();Z.url=w.observable();Z.pageId=w.observable(k);Z.defaultPageId=w.observable();Z.pageTitle=w.observable();Z.usePageTitleAsNodeTitle=w.observable(false);Z.displayOrder=w.observable(0);Z.isDeleted=w.observable(false);Z.isDeleted.subscribe(function(){if(Z.parentNode()){U(Z.parentNode().childNodes());}});Z.childNodes=w.observableArray([]);Z.childNodes.subscribe(U);Z.parentNode=w.observable();Z.translationsEnabled=false;Z.translations={};Z.activeTranslation=w.observable(null);Z.isDisabled=Y;Z.isActive=w.observable(false);Z.isExpanded=w.observable(false);Z.toggleExpand=function(){Z.isExpanded(!Z.isExpanded());};Z.isBeingDragged=w.observable(false);Z.isBeingDragged.subscribe(function(){if(Z.parentNode()){U(Z.parentNode().childNodes());}});Z.activeZone=w.observable(m.None);Z.isFirstNode=w.observable(false);Z.isLastNode=w.observable(false);Z.hasChildNodes=function(){var ab=Z.childNodes();for(var aa=0;aa<ab.length;aa++){if(!ab[aa].isDeleted()){return true;}}return false;};Z.superDraggable=w.observable(false);Z.isUrlReadonly=w.computed(function(){return Z.pageId()==null||Z.pageId()===k?undefined:"readonly";});Z.getUrlReadonlyState=w.computed(function(){return Z.isUrlReadonly();});Z.getNodeHeight=w.computed(function(){if(Z.isActive()){if(Z.getSitemap().showMacros){return Z.isUrlReadonly()?"89px":"136px";}return Z.isUrlReadonly()?"54px":"101px";}return"";});Z.dropOnCancel=false;Z.containerId="node-"+B++;Z.isVisible=w.observable(true);Z.isSearchResult=w.observable(false);Z.startEditSitemapNode=function(){Z.titleOldValue=Z.title();Z.urlOldValue=Z.url();Z.macroOldValue=Z.macro();Z.isActive(true);};Z.cancelEditSitemapNode=function(){Z.isActive(false);Z.title(Z.titleOldValue);Z.url(Z.urlOldValue);Z.macro(Z.macroOldValue);if(Z.dropOnCancel){Z.parentNode().childNodes.remove(Z);i.trigger(p.sitemapNodeRemoved,Z);}};Z.saveSitemapNodeWithValidation=function(){Z.dropOnCancel=false;var aa=a("input","#"+Z.containerId);if(aa.valid()){if(Z.usePageTitleAsNodeTitle()&&Z.titleOldValue!=Z.title()){Z.usePageTitleAsNodeTitle(false);}Z.saveSitemapNode();aa.blur();Z.isActive(false);}};Z.saveSitemapNode=function(){if(Z.getSitemap()==null||!Z.getSitemap().settings.nodeSaveAfterUpdate){return;}var ab=Z.toJson(),aa=function(ac){L.showMessage(ac);if(ac.Success){if(ac.Data){Z.id(ac.Data.Id);Z.version(ac.Data.Version);if(Z.callbackAfterSuccessSaving&&a.isFunction(Z.callbackAfterSuccessSaving)){Z.callbackAfterSuccessSaving(Z);}}}else{if(Z.callbackAfterFailSaving&&a.isFunction(Z.callbackAfterFailSaving)){Z.callbackAfterFailSaving(Z);}}L.showLoading(false);};L.showLoading(true);a.ajax({url:y.saveSitemapNodeUrl,type:"POST",dataType:"json",cache:false,data:ab}).done(function(ac){aa(ac);}).fail(function(ac){aa(i.parseFailedResponse(ac));});};Z.deleteSitemapNode=function(){var ab=false,ac=a.format(r.sitemapDeleteNodeConfirmationMessage,Z.title()),aa=A.confirm({content:ac,onAccept:function(){if(Z.getSitemap()==null||!Z.getSitemap().settings.nodeSaveAfterUpdate){Z.isDeleted(true);aa.close();i.trigger(p.sitemapNodeRemoved,Z);return false;}if(!ab){ab=true;var ae=Z.toJson(),ad=function(af){ab=false;L.showMessage(af);try{if(af.Success){Z.isDeleted(true);Z.parentNode().childNodes.remove(Z);i.trigger(p.sitemapNodeRemoved,Z);}}finally{aa.close();}};a.ajax({url:y.deleteSitemapNodeUrl,type:"POST",dataType:"json",cache:false,data:ae}).done(function(af){ad(af);}).fail(function(af){ad(i.parseFailedResponse(af));});}return false;}});};Z.callbackAfterSuccessSaving=null;Z.callbackAfterFailSaving=null;Z.activateTranslation=function(ac){ac=ac==null?"":ac;if(!Z.translationsEnabled){return;}if(Z.isActive()){Z.cancelEditSitemapNode();}if(Z.activeTranslation()!=null){var aa=Z.activeTranslation(),ab=aa.isModified();if(aa.title()!=Z.title()){aa.title(Z.title());aa.usePageTitleAsNodeTitle(false);ab=true;}if(aa.url()!=Z.url()){aa.url(Z.url());ab=true;}if(aa.macro()!=Z.macro()){aa.macro(Z.macro());ab=true;}aa.isModified(ab);if(aa.languageId()==ac){return;}}if(Z.translations[ac]==null){Z.translations[ac]=new T(Z,ac);if(ac==""){Z.translations[ac].macro(Z.macro());Z.translations[ac].version(Z.version());Z.translations[ac].isModified(true);}else{Z.translations[ac].title(Z.pageId()!=null&&!i.isEmptyGuid(Z.pageId())?Z.translations[""].originalTitle()||Z.translations[""].title():Z.translations[ac].title());}}Z.activeTranslation(Z.translations[ac]);Z.title(Z.translations[ac].title());Z.url(Z.translations[ac].url());Z.version(Z.translations[ac].version());Z.macro(Z.translations[ac].macro());};Z.updateLanguageOnDropNewNode=function(ad,aa){var ab=Z.isActive();Z.translationsEnabled=true;if(Z.pageId()==null||Z.pageId()==k){Z.activateTranslation("");Z.activateTranslation(aa);Z.isActive(ab);return;}var ac=function(af){L.showMessage(af);if(af.Success){if(af.Data!=null&&af.Data!=null){for(var ae=0;ae<af.Data.length;ae++){var ai=af.Data[ae],ag=ai.LanguageId==null?"":ai.LanguageId,ah=new T(Z,ag);ah.pageId(ai.Id);ah.title(ai.Title);ah.originalTitle(ai.Title);ah.url(ai.PageUrl);ah.usePageTitleAsNodeTitle(Z.usePageTitleAsNodeTitle());ah.isModified(true);Z.translations[ag]=ah;if(ag===""){Z.title(ai.Title);Z.url(ai.PageUrl);}}if(Z.translations[""]==null){Z.activateTranslation("");}Z.activateTranslation(aa);Z.isActive(ab);}i.trigger(p.sitemapNodeTranslationsUpdated);}else{Z.isActive(false);Z.isDeleted(true);}L.showLoading(false);};a.ajax({url:a.format(y.getPageTranslations,Z.pageId()),type:"GET",dataType:"json",cache:false,}).done(function(ae){ac(ae);}).fail(function(ae){ac(i.parseFailedResponse(ae));});};Z.getSitemap=function(){if(Z.parentNode()!=null){return Z.parentNode().getSitemap();}return null;};Z.fromJson=function(ad,ai,ab){Z.id(ad.Id);Z.version(ad.Version);Z.title(ad.Title);Z.macro(ad.Macro);Z.url(ad.Url);Z.pageId(ad.PageId);Z.defaultPageId(ad.DefaultPageId);Z.pageTitle(ad.PageTitle);Z.usePageTitleAsNodeTitle(ad.UsePageTitleAsNodeTitle);Z.displayOrder(ad.DisplayOrder);if(ai){Z.translationsEnabled=true;if(ad.Translations!=null){for(var ac=0;ac<ad.Translations.length;ac++){var ah=ad.Translations[ac],ag=new T(Z,ah.LanguageId);ag.id(ah.Id);ag.pageId(ah.PageId);ag.title(ah.Title);ag.usePageTitleAsNodeTitle(ah.UsePageTitleAsNodeTitle);ag.url(ah.Url);ag.version(ah.Version);ag.macro(ah.Macro);Z.translations[ah.LanguageId]=ag;}}Z.activateTranslation("");}var af=[];if(ad.ChildNodes!=null){for(var aa=0;aa<ad.ChildNodes.length;aa++){var ae=new C(ab);ae.fromJson(ad.ChildNodes[aa],ai,ab);ae.parentNode(Z);af.push(ae);}}Z.childNodes(af);};Z.translationsToJson=function(){if(!Z.translationsEnabled){return null;}var ab=[];for(var aa in Z.translations){var ac=Z.translations[aa];if(ac.isModified()&&ac.languageId()!=""){ab.push({Id:ac.id(),LanguageId:ac.languageId(),Title:ac.title(),Macro:ac.macro(),UsePageTitleAsNodeTitle:ac.usePageTitleAsNodeTitle(),Url:ac.url(),Version:ac.version(),});}}return ab;};Z.toJson=function(){var aa=null;if(Z.translationsEnabled){aa=Z.activeTranslation();Z.activateTranslation("");}var ab={Id:Z.id(),Version:Z.translationsEnabled?Z.translations[""].version():Z.version(),Title:Z.translationsEnabled?Z.translations[""].title():Z.title(),Macro:Z.translationsEnabled?Z.translations[""].macro():Z.macro(),UsePageTitleAsNodeTitle:Z.usePageTitleAsNodeTitle(),Url:Z.translationsEnabled?Z.translations[""].url():Z.url(),PageId:Z.pageId(),DisplayOrder:Z.displayOrder(),IsDeleted:Z.isDeleted(),Translations:Z.translationsToJson(),ChildNodes:null};if(Z.translationsEnabled&&aa!=null){Z.activateTranslation(aa.languageId());}return ab;};}function x(ab,aa,ac){var ad=this,Y,Z;ad.languageId=w.observable(aa);ad.languages=[];ad.languages.push({key:"",value:r.invariantLanguage});for(Y=0,Z=ab.length;Y<Z;Y++){ad.languages.push({key:ab[Y].Key,value:ab[Y].Value});}ad.languageId.subscribe(function(ae){if(a.isFunction(ac)){ac(ae);}});return ad;}function T(aa,Z){var ab=this;ab.node=aa;ab.id=w.observable();ab.pageId=w.observable();ab.macro=w.observable();ab.usePageTitleAsNodeTitle=w.observable(false);ab.languageId=w.observable(Z==null?"":Z);var Y=aa.translations[""];if(Y!=null){ab.title=w.observable(Y.title());ab.url=w.observable(Y.url());ab.originalTitle=w.observable(Y.title());}else{ab.title=w.observable(aa.title());ab.url=w.observable(aa.url());ab.originalTitle=w.observable(aa.title());}ab.version=w.observable(0);ab.isModified=w.observable(false);}function G(aa,Y){var Z=this;Z.searchQuery=w.observable("");Z.pageLinks=w.observableArray([]);Z.sitemap=aa;Z.hasfocus=w.observable(false);Y.find(K.secondTabButton).on("click",function(){Z.hasfocus(true);});Z.searchForPageLinks=function(){var af=a.trim(Z.searchQuery()).length===0;var ad=Z.pageLinks();for(var ab=0;ab<ad.length;ab++){if(af){ad[ab].isVisible(true);}else{var ac=ad[ab],ae=Z.searchQuery().toLowerCase(),ag=ac.title().toLowerCase(),ah=ac.url().toLowerCase();ac.isVisible(ag.indexOf(ae)!==-1||ah.indexOf(ae)!==-1);}}var ai=Z.searchQuery();Z.hasfocus(true);Z.searchQuery("");Z.searchQuery(ai);};Z.parseJsonLinks=function(ad){var af=[],ab=new D();ab.title(r.sitemapEditorDialogCustomLinkTitle);ab.url("/../");ab.pageId(k);ab.isCustom(true);af.push(ab);for(var ac=0;ac<ad.length;ac++){var ae=new D();ae.fromJson(ad[ac]);af.push(ae);}Z.pageLinks(af);Z.updateStatusOfLinks();};Z.title=aa.title;Z.tags=aa.tags;Z.accessControl=aa.accessControl;Z.updateStatusOfLinks=function(){var ag=[],ah=[],ab=function(al){var ai,ak,aj,an,ao,ap;for(ai=0;ai<al.length;ai++){if(!al[ai].isDeleted()){var am=al[ai].defaultPageId()||al[ai].pageId();if(am!=null&&am!=k){ag[am]=true;if(al[ai].translations!=null){for(ak in al[ai].translations){an=al[ai].translations[ak];if(an&&an.pageId&&a.isFunction(an.pageId)){ao=an.pageId();if(ao){ag[ao]=true;}}}}}else{var aq=al[ai].url();if(aq){ah[aq]=true;if(al[ai].translations!=null){for(aj in al[ai].translations){an=al[ai].translations[aj];if(an&&an.url&&a.isFunction(an.url)){ap=an.url();if(ap){ah[ap]=true;}}}}}}}ab(al[ai].childNodes());}};ab(Z.sitemap.childNodes());var af=Z.pageLinks();for(var ac=0;ac<af.length;ac++){var ad=af[ac],ae=ag[ad.pageId()]===true||ah[ad.url()]===true;if(ad.isOnSitemap()!=ae){ad.isOnSitemap(ae);}}};i.on(p.sitemapNodeAdded,Z.updateStatusOfLinks);i.on(p.sitemapNodeRemoved,Z.updateStatusOfLinks);i.on(p.sitemapNodeTranslationsUpdated,Z.updateStatusOfLinks);}function D(ab,ac,Z,Y){var aa=this;aa.title=w.observable(ab);aa.url=w.observable(ac);aa.pageId=w.observable(Z);aa.languageId=w.observable(Y);aa.isVisible=w.observable(true);aa.isCustom=w.observable(false);aa.isBeingDragged=w.observable(false);aa.superDraggable=w.observable(false);aa.isOnSitemap=w.observable(false);aa.onDrop=null;aa.dropped=function(ad){if(aa.onDrop&&a.isFunction(aa.onDrop)){aa.onDrop(ad);}};aa.fromJson=function(ad){aa.isVisible(true);aa.title(ad.Title);aa.url(ad.Url);aa.pageId(ad.Id);aa.languageId(ad.LanguageId);};}function e(ab,Z,Y){var aa=this;aa.pageLink=Z;aa.pageLink.superDraggable(true);aa.sitemap=ab;aa.onSkipClick=Y;aa.linkIsDropped=w.observable(false);aa.sitemapNode=null;aa.pageLink.onDrop=function(ac){aa.linkIsDropped(true);aa.pageLink.isVisible(false);aa.sitemapNode=ac;};aa.skipClicked=function(){if(aa.onSkipClick&&a.isFunction(aa.onSkipClick)){aa.onSkipClick();}};aa.undoClicked=function(){if(aa.sitemapNode!=null){aa.sitemapNode.parentNode().childNodes.remove(aa.sitemapNode);aa.sitemapNode=null;}aa.pageLink.isVisible(true);aa.linkIsDropped(false);};}function R(Y,ae){var ag=this,ai=Y.find(K.tabsSlider),ab=ai.find(K.tabsSliderLeftArrow),af=ai.find(K.tabsSliderRightArrow),aa=ae.tabs(),Z=0,ad=0,ac=0;ag.canSlideLeft=w.observable(false);ag.canSlideRight=w.observable(false);ag.showSliders=w.observable(true);ag.slideLeft=function(){if(ag.canSlideLeft()){ah(-1);}};ag.slideRight=function(){if(ag.canSlideRight()){ah(1);}};ag.initialize=function(){var ak=0;ad=ai.width()-ab.outerWidth(true)-af.outerWidth(true)-20;for(var aj=0;aj<aa.length;aj++){aa[aj].width=ai.find("#"+aa[aj].tabId).outerWidth(true);ak+=aa[aj].width;}if(ak<ad){ag.showSliders(false);}ah(0);};function ah(am){var al=aa.length,an=0,aj=0,ao,ak;Z+=am;for(ak=0;ak<al;ak++){ao=true;if(aa[ak].isActive()){aj=ak;}if(ak<Z){ao=false;}else{an+=aa[ak].width;if(an>ad){ao=false;}else{ac=ak;}}aa[ak].isVisible(ao);}if(aj<Z||aj>ac){if(am>0){aa[Z].activate();}else{aa[ac].activate();}}ag.canSlideLeft(Z>0);ag.canSlideRight(ac<aa.length-1);}return ag;}function Q(ab,Y){var aa=this;aa.activeTab=w.observable();aa.activeNewPageViewModel=w.observable();aa.activateTab=function(ad){var ac=aa.activeTab();if(ac){ac.isActive(false);}ad.isActive(true);L.activeMapModel=ad.newPageViewModel.sitemap;aa.activeTab(ad);aa.activeNewPageViewModel(ad.newPageViewModel);};for(var Z=0;Z<ab.length;Z++){ab[Z].activateTab=aa.activateTab;}aa.tabs=w.observableArray(ab);aa.tabs()[0].activate();aa.slider=new R(Y,aa);}function P(Y){var Z=this;Z.newPageViewModel=Y;Z.isActive=w.observable(false);Z.activateTab=null;Z.width=0;Z.isVisible=w.observable(false);Z.activate=function(){Z.activateTab(Z);};Z.tabId="bms-sitemaps-tab-"+O;O++;}function W(Y){var Z=this;Z.sitemap=new M(Y);Z.sitemap.parseJsonNodes(Y.RootNodes);Z.sitemap.settings.canEditNode=false;Z.sitemap.settings.canDeleteNode=false;Z.sitemap.settings.canDragNode=false;Z.sitemap.settings.canDropNode=false;Z.sitemap.settings.nodeSaveAfterUpdate=false;}function v(aa,Y){var Z=aa.container.find(K.modalContent);Z.find(K.gridRestoreLinks).on("click",function(ac){i.stopEventPropagation(ac);F(aa,a(this).data("id"),function(ad){if(a.isFunction(Y)){Y(ad);}H(aa,Z,ab,Y);});});Z.find(K.gridCells).on("click",function(){var af=a(this),ae=af.parents(K.firstRow),ad=ae.find(K.gridRowPreviewLink),ac=ad.data("id");Z.find(K.gridRows).removeClass(j.tableActiveRow);ae.addClass(j.tableActiveRow);E(aa,ac);});var ab=Z.find(K.sitemapHistoryForm);s.bindGridForm(ab,function(ac){Z.html(ac);v(aa,Y);});ab.on("submit",function(ac){i.stopEventPropagation(ac);H(aa,Z,ab,Y);return false;});ab.find(K.sitemapHistorySearchButton).on("click",function(){H(aa,Z,ab,Y);});}function E(Y,Z){var ad=a.format(y.loadSitemapVersionPreviewUrl,Z),ac=Y.container.find(K.versionPreviewContainer),aa=Y.container.find(K.versionPreviewLoaderContainer),ab=function(ae,af){ac.html(ae);if(af&&af.Success){u(ac,af.Data);}aa.hideLoading();};aa.showLoading();a.ajax({type:"GET",cache:false,url:ad,error:function(){aa.hideLoading();},success:function(ae,ag,af){if(af.getResponseHeader("Content-Type").indexOf("application/json")===0&&ae.Html){z.refreshBox(Y.container,ae);ab(ae.Html,ae);}else{ab(ae,null);}}});}function u(Y,aa){if(aa){var Z=Y.get(0),ab=new W(aa);if(Z){w.cleanNode(Z);w.applyBindings(ab,Z);}}}function F(Z,aa,Y){var ab=function(ac){var ae=a.format(y.restoreSitemapVersionUrl,aa,ac),ad=function(af){Z.container.hideLoading();z.refreshBox(Z.container,af);if(af.Success){Y(af);}else{if(af.Data&&af.Data.ConfirmationMessage){A.confirm({content:af.Data.ConfirmationMessage,onAccept:function(){ab(1);}});}}};Z.container.showLoading();a.ajax({type:"POST",cache:false,url:ae}).done(function(af){ad(af);}).fail(function(af){ad(i.parseFailedResponse(af));});};A.confirm({content:r.sitemapVersionRestoreConfirmation,acceptTitle:r.restoreButtonTitle,onAccept:function(){ab(0);}});}function H(aa,Z,ab,Y){s.submitGridForm(ab,function(ac){Z.html(ac);v(aa,ac,Y);});}L.init=function(){i.logger.debug("Initializing bcms.pages.sitemap module.");b();c();i.on(i.events.pageCreated,L.loadAddNewPageDialog);};i.registerInit(L.init);return L;});bettercms.define("bcms.pages.template",["bcms.jquery","bcms","bcms.modal","bcms.datepicker","bcms.dynamicContent","bcms.siteSettings","bcms.messages","bcms.preview","bcms.grid","bcms.inlineEdit","bcms.options","bcms.ko.extenders","bcms.pages.masterpage","bcms.pages","bcms.antiXss","bcms.pages.properties"],function(a,d,w,e,h,F,v,A,o,j,x,s,u,z,c,y){var G={},t={loadSiteSettingsTemplateListUrl:null,loadRegisterTemplateDialogUrl:null,loadEditTemplateDialogUrl:null,deleteTemplateUrl:null,loadTemplateRegionDialogUrl:null},n={createTemplateDialogTitle:null,editTemplateDialogTitle:null,deleteTemplateConfirmMessage:null,deleteRegionConfirmMessage:null,editTemplateRegionTitle:null,previewImageNotFoundMessage:null,deletingMessage:null,templatesTabTitle:null,},C={templatePreviewImageUrl:"#PreviewImageUrl",templatePreviewImage:"#bcms-template-preview-image",templateNoImagePreview:"#bcms-template-no-preview",htmlContentTemplateRowTemplate:"#bcms-advanced-content-list-row-template",htmlContentTemplateRowTemplateFirstRow:"tr:first",htmlContentTemplateTableFirstRow:"table.bcms-tables > tbody > tr:first",messagesContainer:"#bcms-edit-template-messages",siteSettingsTemplatesListForm:"#bcms-templates-form",templateSearchButton:"#bcms-template-search-btn",templateSearchField:".bcms-search-query",templateRegisterButton:"#bcms-register-template-button",templateCreateButton:"#bcms-create-page-button",templateRowEditButtons:".bcms-grid-item-edit-button",templatesRowDeleteButtons:".bcms-grid-item-delete-button",templatesRowDeleteMessage:".bcms-grid-item-message",templatesRowUsageLinks:".bcms-action-usage",templatesRowDeleteElementsToHide:".bcms-grid-item-delete-button, .bcms-grid-item-edit-button",templateParentRow:"tr:first",templateNameCell:".bcms-template-name",templateRowTemplate:"#bcms-template-list-row-template",templateRowTemplateFirstRow:"tr:first",templateTableFirstRow:"table.bcms-tables > tbody > tr:first",templateInsertButtons:".bcms-template-insert-button",addNewRegionButton:"#bcms-add-region-button",templatesListForm:"#bcms-templates-form",templateEditForm:"#bcms-template-form",regionsTable:"#bcms-regions-grid",regionsTab:"#bcms-tab-2",optionsTab:"#bcms-tab-3",siteSettingsButtonOpener:".bcms-btn-opener",siteSettingsButtonHolder:".bcms-btn-opener-holder"};G.links=t;G.globalization=n;G.openEditTemplateDialog=function(J,H){var I;w.open({title:n.editTemplateDialogTitle,onLoad:function(K){h.bindDialog(K,a.format(t.loadEditTemplateDialogUrl,J),{contentAvailable:function(M,L){I=p(M,L);},beforePost:function(L){j.resetAutoGenerateNameId();j.setInputNames(L.find(C.regionsTab));return I.isValid(true);},postSuccess:H});}});};G.openRegisterTemplateDialog=function(H){var I;w.open({title:n.createTemplateDialogTitle,onLoad:function(J){h.bindDialog(J,t.loadRegisterTemplateDialogUrl,{contentAvailable:function(L,K){I=p(L,K);},beforePost:function(K){j.resetAutoGenerateNameId();j.setInputNames(K.find(C.regionsTab));return I.isValid(true);},postSuccess:H});}});};function p(J,H){var P=J.container.find(C.regionsTab),N=J.container.find(C.optionsTab),K=J.container.find(C.templateEditForm),Q=H&&H.Data?H.Data.Options:null,I=H&&H.Data?H.Data.CustomOptions:null,M=x.createOptionsViewModel(N,Q,I);j.initialize(P,{deleteRowMessageExtractor:function(){return n.deleteRegionConfirmMessage;},form:K});P.find(C.addNewRegionButton).on("click",function(){j.addNewRow(P,a(C.regionsTable));});s.applyBindings(M,N.get(0));J.container.find(C.templatePreviewImage).error(function(){var R=J.container.find(C.templatePreviewImage),S=J.container.find(C.templateNoImagePreview);S.show();if(R.attr("src")!=null&&R.attr("src")!=""){v.box({container:J.container.find(C.messagesContainer)}).addWarningMessage(n.previewImageNotFoundMessage);R.hide();R.removeAttr("src");}});J.container.find(C.templatePreviewImageUrl).blur(function(){var R=J.container.find(C.templatePreviewImage),T=J.container.find(C.templatePreviewImageUrl),S=J.container.find(C.templateNoImagePreview);if(T.valid()){R.attr({src:T.val()});S.hide();R.show();}else{R.hide();S.show();R.removeAttr("src");}});var O=J.container.find(C.templatePreviewImage),L=J.container.find(C.templateNoImagePreview);if(O.attr("src")){L.hide();O.show();}return M;}G.editTemplate=function(I,H){G.openEditTemplateDialog(I,H);};G.deleteTemplate=function(M,K){var N=M.data("id"),P=M.data("version"),O=M.find(C.templateNameCell).html(),Q=a.format(t.deleteTemplateUrl,N,P),I=a.format(n.deleteTemplateConfirmMessage,O),J=M.find(C.templatesRowDeleteMessage),H=M.find(C.templatesRowDeleteElementsToHide),L=function(R){v.refreshBox(M,R);J.html("");J.hide();H.show();if(R.Success&&a.isFunction(K)){K(R);}};w.confirm({content:I,onAccept:function(){H.hide();J.show();J.html(n.deletingMessage);a.ajax({type:"POST",url:Q,contentType:"application/json; charset=utf-8",dataType:"json",cache:false}).done(function(R){L(R);}).fail(function(R){L(d.parseFailedResponse(R));});}});};G.loadSiteSettingsTemplateList=function(){h.bindSiteSettings(F,t.loadSiteSettingsTemplateListUrl,{contentAvailable:r});};function r(K){var I=F.getModalDialog(),H=I.container.find(C.siteSettingsTemplatesListForm),L=function(M){if(M.Success&&M.Data!=null){var O=a(C.templateRowTemplate),N=a(O.html()).find(C.templateRowTemplateFirstRow);E(N,M);v.refreshBox(C.templatesListForm,M);N.insertBefore(a(C.templateTableFirstRow,H));q(N);o.showHideEmptyRow(H);}};var J=I.container.find(C.templatesListForm);o.bindGridForm(J,function(M){H.html(M);r();});J.on("submit",function(M){M.preventDefault();B(J,H);return false;});J.find(C.templateSearchButton).on("click",function(){var M=a(this).parent();if(!M.hasClass("bcms-active-search")){J.find(C.templateSearchField).prop("disabled",false);M.addClass("bcms-active-search");J.find(C.templateSearchField).focus();}else{J.find(C.templateSearchField).prop("disabled",true);M.removeClass("bcms-active-search");J.find(C.templateSearchField).val("");}});J.find(C.siteSettingsButtonOpener).on("click",function(M){d.stopEventPropagation(M);var N=J.find(C.siteSettingsButtonHolder);if(!N.hasClass("bcms-opened")){N.addClass("bcms-opened");}else{N.removeClass("bcms-opened");}});d.on(d.events.bodyClick,function(M){var N=J.find(C.siteSettingsButtonHolder);if(N.hasClass("bcms-opened")){N.removeClass("bcms-opened");}});H.find(C.templateRegisterButton).on("click",function(){G.openRegisterTemplateDialog(L);});if(K===true){J.find(C.templateSearchButton).parent().addClass("bcms-active-search");}else{J.find(C.templateSearchField).prop("disabled",true);}q(H);o.focusSearchInput(I.container.find(C.templateSearchField),true);}function B(I,H){o.submitGridForm(I,function(J){H.html(J);r(true);});}function q(H){H.find(C.templateRowEditButtons).on("click",function(I){var J=a(this).data("url");if(J){d.stopEventPropagation(I);window.open(J);}else{k(H,a(this));}});H.find(C.templatesRowDeleteButtons).on("click",function(){g(H,a(this));});H.find(C.templatesRowUsageLinks).on("click",function(I){d.stopEventPropagation(I);m(a(this));});H.find(C.templateCreateButton).on("click",function(){b(H);});}function k(H,L){var K=L.parents(C.templateParentRow),I=K.data("id"),J=K.data("ismasterpage");if(J==0){G.editTemplate(I,function(M){if(M.Data!=null){E(K,M);o.showHideEmptyRow(H);}});}else{i(K,H,function(M){if(M.Data!=null){D(K,M);o.showHideEmptyRow(H);}});}}function g(H,K){var J=K.parents(C.templateParentRow),I=J.data("ismasterpage");if(I==1){f(J,H);}else{G.deleteTemplate(J,function(L){v.refreshBox(J,L);if(L.Success){J.remove();o.showHideEmptyRow(H);}});}}function m(K){var J=K.parents(C.templateParentRow),H=J.data("id"),I=J.data("ismasterpage");if(I==1){l(J);}else{z.openPageSelectDialog({params:{Layout:"l-"+H},canBeSelected:false,title:z.globalization.pagesListTitle,disableAccept:true});}}function b(H){var I=function(J){if(J.Data!=null){var L=a(C.templateRowTemplate),K=a(L.html()).find(C.templateRowTemplateFirstRow);D(K,J);v.refreshBox(C.templatesListForm,J);K.insertBefore(a(C.templateTableFirstRow,H));q(K);o.showHideEmptyRow(H);}};z.openCreatePageDialog(I,true);}function i(K,H,J){var I=K.data("id");y.openEditPageDialog(I,J,n.editMasterPagePropertiesModalTitle);}function l(I){var H=I.data("id");z.openPageSelectDialog({params:{Layout:"m-"+H},canBeSelected:false,title:z.globalization.pagesListTitle,disableAccept:true});}function f(J,H){var I=J.data("id");z.deletePage(I,function(K){v.refreshBox(J,K);if(K.Success){J.remove();o.showHideEmptyRow(H);}});}function E(I,H){I.data("id",H.Data.Id);I.data("version",H.Data.Version);I.data("ismasterpage",0);I.find(C.templateNameCell).html(c.encodeHtml(H.Data.TemplateName));}function D(I,H){I.data("id",H.Data.PageId);I.data("version",H.Data.Version);I.data("ismasterpage",1);I.find(C.templateNameCell).html(c.encodeHtml(H.Data.Title));I.find(C.templateNameCell).data("url",H.Data.PageUrl);}return G;});bettercms.define("bcms.pages.masterpage",["bcms.jquery","bcms","bcms.siteSettings","bcms.pages","bcms.grid","bcms.pages.properties","bcms.messages","bcms.antiXss"],function(a,d,r,n,i,o,l,c){var m={},k={loadMasterPagesListUrl:null,},h={masterPagesTabTitle:null,editMasterPagePropertiesModalTitle:null},q={searchField:".bcms-search-query",searchButton:"#bcms-pages-search-btn",siteSettingsMasterPagesForm:"#bcms-master-pages-form",siteSettingsMasterPageCreateButton:"#bcms-create-page-button",siteSettingsMasterPageCreateButtonSidePanel:"#bcms-create-page-button-side-panel",siteSettingsPageParentRow:"tr:first",siteSettingsPageTitleCell:".bcms-page-title",siteSettingsPageEditButton:".bcms-grid-item-edit-button",siteSettingsPageDeleteButton:".bcms-grid-item-delete-button",siteSettingsPageUsageLink:".bcms-action-usage",siteSettingsPagesListFormFilterIncludeArchived:"#IncludeArchived",siteSettingsPageRowTemplate:"#bcms-pages-list-row-template",siteSettingsPageRowTemplateFirstRow:"tr:first",siteSettingsPagesTableFirstRow:"table.bcms-tables > tbody > tr:first",siteSettingsRowCells:"td",};m.links=k;m.globalization=h;m.initializeMasterPagesList=function(s){var t=r.getModalDialog(),u=t.container.find(q.siteSettingsMasterPagesForm);i.bindGridForm(u,function(w,v){s.html(w);m.initializeMasterPagesList(s);});u.on("submit",function(v){v.preventDefault();p(u,s);return false;});d.preventInputFromSubmittingForm(u.find(q.searchField),{preventedEnter:function(){p(u,s);},});u.find(q.searchButton).on("click",function(){p(u,s);});j(s);i.focusSearchInput(s.find(q.searchField),true);};function p(t,s){i.submitGridForm(t,function(v,u){s.html(v);m.initializeMasterPagesList(s);});}function j(s){s.find(q.siteSettingsMasterPageCreateButton).on("click",function(){b(s);});s.find(q.siteSettingsMasterPageCreateButtonSidePanel).on("click",function(){b(s);});s.find(q.siteSettingsRowCells).on("click",function(){var t=a(this).parents(q.siteSettingsPageParentRow).find(q.siteSettingsPageEditButton);if(t.length>0){f(t,s);}});s.find(q.siteSettingsPageTitleCell).on("click",function(t){d.stopEventPropagation(t);var u=a(this).data("url");window.open(u);});s.find(q.siteSettingsPageDeleteButton).on("click",function(t){d.stopEventPropagation(t);e(a(this),s);});s.find(q.siteSettingsPageUsageLink).on("click",function(t){d.stopEventPropagation(t);g(a(this),s);});}function b(s){n.openCreatePageDialog(function(t){if(t.Data!=null){var v=a(q.siteSettingsPageRowTemplate),u=a(v.html()).find(q.siteSettingsPageRowTemplateFirstRow);u.find(q.siteSettingsPageTitleCell).html(c.encodeHtml(t.Data.Title));if(s.hasClass("js-redirect-to-new-page")&&t.Data.IsMasterPage){window.location.href=t.Data.PageUrl;}u.find(q.siteSettingsPageTitleCell).data("url",t.Data.PageUrl);u.find(q.siteSettingsPageEditButton).data("id",t.Data.PageId);u.find(q.siteSettingsPageDeleteButton).data("id",t.Data.PageId);u.find(q.siteSettingsPageDeleteButton).data("version",t.Data.Version);u.insertBefore(a(q.siteSettingsPagesTableFirstRow,s));j(u);i.showHideEmptyRow(s);}},true);}function f(u,s){var t=u.data("id");o.openEditPageDialog(t,function(w){if(w.Data!=null){if(w.Data.IsArchived){var x=s.find(q.siteSettingsMasterPagesForm),y=x.find(q.siteSettingsPagesListFormFilterIncludeArchived);if(!y.is(":checked")){u.parents(q.siteSettingsPageParentRow).remove();i.showHideEmptyRow(s);return;}}var z=u.parents(q.siteSettingsPageParentRow),v=z.find(q.siteSettingsPageTitleCell);v.html(c.encodeHtml(w.Data.Title));v.data("url",w.Data.PageUrl);}},h.editMasterPagePropertiesModalTitle);}function g(t){var s=t.data("id");n.openPageSelectDialog({params:{Layout:"m-"+s},canBeSelected:false,title:n.globalization.pagesListTitle,disableAccept:true});}function e(u,s){var t=u.data("id");n.deletePage(t,function(v){u.parents(q.siteSettingsPageParentRow).remove();l.refreshBox(q.siteSettingsMasterPagesForm,v);i.showHideEmptyRow(s);});}m.addMasterPage=b;return m;});bettercms.define("bcms.pages.widgets",["bcms.jquery","bcms","bcms.modal","bcms.datepicker","bcms.htmlEditor","bcms.dynamicContent","bcms.siteSettings","bcms.messages","bcms.preview","bcms.grid","bcms.redirect","bcms.pages.history","bcms.security","bcms.options","bcms.ko.extenders","bcms.codeEditor","bcms.pages","bcms.categories","bcms.forms","bcms.ko.grid","bcms.antiXss"],function(a,c,z,i,q,k,M,y,G,p,H,g,J,E,v,f,F,d,n,w,b){var O={},x={loadSiteSettingsWidgetListUrl:null,loadCreateHtmlContentWidgetDialogUrl:null,loadEditHtmlContentWidgetDialogUrl:null,loadCreateServerControlWidgetDialogUrl:null,loadEditServerControlWidgetDialogUrl:null,deleteWidgetUrl:null,loadPageContentOptionsDialogUrl:null,loadChildContentOptionsDialogUrl:null,getContentTypeUrl:null,getWidgetUsagesUrl:null},o={createHtmlContentWidgetDialogTitle:null,editAdvancedContentDialogTitle:null,createWidgetDialogTitle:null,editWidgetDialogTitle:null,deleteWidgetConfirmMessage:null,editPageWidgetOptionsTitle:null,previewImageNotFoundMessage:null,widgetStatusPublished:null,widgetStatusDraft:null,widgetStatusPublishedWithDraft:null,deletingMessage:null,widgetUsageTitle:null,editChildWidgetOptionsTitle:null,editChildWidgetOptionsCloseButtonTitle:null,widgetUsagesDialogTitle:null,widgetUsagesType_Page:null,widgetUsagesType_HtmlWidget:null,widgetUsagesType_MasterPage:null,invariantLanguage:null},K={desirableStatus:"#bcmsWidgetDesirableStatus",destroyDraftVersionLink:".bcms-messages-draft-destroy",contentId:"#bcmsContentId",contentVersion:"#bcmsContentVersion",messagesContainer:"#bcms-edit-widget-messages",widgetPreviewImageUrl:"#PreviewImageUrl",widgetPreviewImage:"#bcms-widget-preview-image",widgetNoImagePreview:"#bcms-widget-no-preview",widgetPreviewPageContentId:".bcms-preview-page-content-id",htmlContentWidgetContentHtmlEditor:".bcms-advanced-contenthtml",htmlContentWidgetRowTemplate:"#bcms-advanced-content-list-row-template",htmlContentWidgetRowTemplateFirstRow:"tr:first",htmlContentWidgetTableFirstRow:"table.bcms-tables > tbody > tr:first",widgetsSearchButton:"#bcms-widget-search-btn",widgetsSearchField:".bcms-search-query",widgetCreateButton:"#bcms-create-widget-button",widgetRegisterButton:"#bcms-register-widget-button",widgetRowEditButton:".bcms-grid-item-edit-button",widgetRowHistoryButton:".bcms-grid-item-history-button",widgetsRowDeleteButtons:".bcms-grid-item-delete-button",widgetsRowDeleteMessage:".bcms-grid-item-message",widgetsRowDeleteElementsToHide:".bcms-grid-item-delete-button, .bcms-grid-item-edit-button, bcms-widget-status, .bcms-widget-status > div, .bcms-grid-item-history-button",widgetParentRow:"tr:first",widgetNameCell:".bcms-widget-name",widgetCategoryNameCell:".bcms-category-name",widgetStatusCell:".bcms-widget-status",widgetRowDeleteButtons:".bcms-grid-item-delete-button",widgetRowTemplate:"#bcms-widget-list-row-template",widgetRowCells:"td",widgetRowTemplateFirstRow:"tr:first",widgetsTableFirstRow:"table.bcms-tables > tbody > tr:first",widgetInsertButtons:".bcms-widget-insert-button",widgetRowUsageLinks:".bcms-action-usage",siteSettingsWidgetsListForm:"#bcms-widgets-form",widgetTab:"#bcms-tab-1",optionsTab:"#bcms-tab-2",htmlWidgetJsCssTabOpener:'.bcms-tab-item[data-name="#bcms-tab-3"]',pageContentOptionsForm:"#bcms-options-form",editInSourceModeHiddenField:"#bcms-edit-in-source-mode",widgetUsagesGrid:"#bcms-widget-usages-grid",userConfirmationHiddenField:"#bcms-user-confirmed-region-deletion",editContentCloseInfoMessage:"#bcms-draft-closeinfomessage",editContentInfoMessageBox:".bcms-warning-messages",siteSettingsButtonOpener:".bcms-btn-opener",siteSettingsButtonHolder:".bcms-btn-opener-holder",editorContainer:".bcms-window-tabbed-options",editorTitle:".bcms-content-titles",editorCheckBoxField:".bcms-check-field-helper",codeEditorParent:".bcms-input-list-holder",editorInfoBlock:".bcms-content-info-block"},e={regionAdvancedContent:"bcms-content-advanced",regionWidget:"bcms-content-widget",draftStatus:"bcms-action-warn",publishStatus:"bcms-action-ok",draftPublStatus:"bcms-action-draft"},h={htmlWidget:"html-widget",serverWidget:"server-widget"},Q={htmlWidget:"HtmlContent",serverWidget:"ServerControl"},R={page:1,masterPage:2,htmlWidget:3},P={};P[Q.htmlWidget]=h.htmlWidget;P[Q.serverWidget]=h.serverWidget;O.links=x;O.globalization=o;O.openCreateHtmlContentWidgetDialog=function(V,S){var U,T;z.edit({isPreviewAvailable:S!=null,title:o.createHtmlContentWidgetDialogTitle,onLoad:function(W){k.bindDialog(W,x.loadCreateHtmlContentWidgetDialogUrl,{contentAvailable:function(Y,X){T=Y.container.find(K.htmlContentWidgetContentHtmlEditor).attr("id");var Z=false;if(X&&X.Data&&X.Data.EditInSourceMode){Z=true;}U=r(Y,S,V,Z,X,T,false);},beforePost:function(){var X=q.isSourceMode(T);W.container.find(K.editInSourceModeHiddenField).val(X);return U.isValid(true);},postSuccess:V,formSerialize:function(X){return O.serializeFormWithChildWidgetOptions(X,T,U);},formContentType:"application/json; charset=utf-8"});},onAccept:function(){q.destroyHtmlEditorInstance(T);},onClose:function(){q.destroyHtmlEditorInstance(T);}});};O.openEditHtmlContentWidgetDialog=function(U,Y,S,W,V){var X,T;V=(V===true)?1:0;z.edit({isPreviewAvailable:S!=null,title:o.editAdvancedContentDialogTitle,onLoad:function(Z){k.bindDialog(Z,a.format(x.loadEditHtmlContentWidgetDialogUrl,U),{contentAvailable:function(ab,aa){T=ab.container.find(K.htmlContentWidgetContentHtmlEditor).attr("id");var ac=false;if(aa&&aa.Data&&aa.Data.EditInSourceMode){ac=true;}X=r(ab,S,Y,ac,aa,T,V);},beforePost:function(){var aa=q.isSourceMode(T);Z.container.find(K.editInSourceModeHiddenField).val(aa);return X.isValid(true);},postSuccess:Y,postError:function(aa){if(aa.Data&&aa.Data.ConfirmationMessage){z.confirm({content:aa.Data.ConfirmationMessage,onAccept:function(){Z.container.find(K.userConfirmationHiddenField).val(true);Z.submitForm();return true;}});}},formSerialize:function(aa){return O.serializeFormWithChildWidgetOptions(aa,T,X,function(ab){if(V){ab.IncludeChildRegions=true;}});},formContentType:"application/json; charset=utf-8"});},onAccept:function(){q.destroyHtmlEditorInstance(T);},onClose:function(){q.destroyHtmlEditorInstance(T);if(a.isFunction(W)){W();}}});};O.openEditServerControlWidgetDialog=function(W,U,S,T){var V;z.edit({isPreviewAvailable:S!=null,disableSaveDraft:true,title:o.editWidgetDialogTitle,onClose:T,onLoad:function(X){k.bindDialog(X,a.format(x.loadEditServerControlWidgetDialogUrl,W),{contentAvailable:function(Z,Y){V=s(Z,S,U,Y.Data);},beforePost:function(){return V.isValid(true);},postSuccess:U,formSerialize:function(Y){return O.serializeFormWithChildWidgetOptions(Y,null,V);},formContentType:"application/json; charset=utf-8"});}});};O.openCreateServerControlWidgetDialog=function(T,S){var U;z.edit({isPreviewAvailable:S!=null,disableSaveDraft:true,title:o.createWidgetDialogTitle,onLoad:function(V){k.bindDialog(V,x.loadCreateServerControlWidgetDialogUrl,{contentAvailable:function(X,W){U=s(X,S,T,W.Data);},beforePost:function(){return U.isValid(true);},postSuccess:T,formSerialize:function(W){return O.serializeFormWithChildWidgetOptions(W,null,U);},formContentType:"application/json; charset=utf-8"});}});};function N(T){var U=this,S=new d.CategoriesSelectListModel(T.Categories);U.categories=S;}function r(X,S,ae,Y,U,Z,ab){var ag=X.container.find(K.optionsTab),ai=X.container.find(K.widgetTab),W=U.Data||{},ak=W.Options,V=W.CustomOptions,ah=W.ShowLanguages,ad=W.Languages,ac={showLanguages:ah,languages:ad,translationsEnabled:ah},af=E.createOptionsViewModel(ag,ak,V,ac),aj=new N(W),T=false;d.initCategoriesSelect(aj.categories,W.CategoriesLookupList);v.applyBindings(af,ag.get(0));v.applyBindings(aj,ai.get(0));if(S!==null){X.container.find(K.widgetPreviewPageContentId).val(S);}X.container.find(K.destroyDraftVersionLink).on("click",function(){var al=X.container.find(K.contentId).val(),am=X.container.find(K.contentVersion).val();g.destroyDraftVersion(al,am,ab,X.container,function(ap,an){X.close();var ao=function(){D(ae,an);};O.openEditHtmlContentWidgetDialog(ap,ae,S,ao);});});var aa={topElements:[{element:K.editorInfoBlock,takeMargins:true},{element:K.editorTitle,takeMargins:true}],container:K.editorContainer,bottomElement:K.editorCheckBoxField,parent:K.widgetTab,marginBottom:1};q.initializeHtmlEditor(Z,W.Id,{cmsEditorType:q.cmsEditorTypes.widget},Y,aa);q.enableInsertDynamicRegion(Z,false,W.LastDynamicRegionNumber);X.container.find(K.editContentCloseInfoMessage).on("click",function(){X.container.find(K.editContentInfoMessageBox).hide();});X.container.find(K.htmlWidgetJsCssTabOpener).on("click",function(){if(!T){var al={marginTop:30,topElements:[{element:K.editorTitle,takeMargins:true}],container:K.editorContainer,bottomElement:K.editorCheckBoxField,parent:K.codeEditorParent,marginBottom:1};f.initialize(X.container,X,{cmsEditorType:q.cmsEditorTypes.page},al);T=true;}});return af;}function s(V,S,Z,U){if(S!==null){V.container.find(K.widgetPreviewPageContentId).val(S);}var ab=V.container.find(K.optionsTab),ae=V.container.find(K.widgetTab),ag=U!=null?U.Options:null,T=U!=null?U.CustomOptions:null,ad=U!=null?U.ShowLanguages:null,X=U!=null?U.Languages:null,W={showLanguages:ad,languages:X,translationsEnabled:ad},aa=E.createOptionsViewModel(ab,ag,T,W),af=new N(U);d.initCategoriesSelect(af.categories,U.CategoriesLookupList);v.applyBindings(aa,ab.get(0));v.applyBindings(af,ae.get(0));V.container.find(K.widgetPreviewImage).error(function(){var ah=V.container.find(K.widgetPreviewImage),ai=V.container.find(K.widgetNoImagePreview);ai.show();if(ah.attr("src")!=null&&ah.attr("src")!=""){y.box({container:V.container.find(K.messagesContainer)}).addWarningMessage(o.previewImageNotFoundMessage);ah.hide();ah.removeAttr("src");}});V.container.find(K.widgetPreviewImageUrl).blur(function(){var ah=V.container.find(K.widgetPreviewImage),aj=V.container.find(K.widgetPreviewImageUrl),ai=V.container.find(K.widgetNoImagePreview);if(aj.valid()){ah.attr({src:aj.val()});ai.hide();ah.show();}else{ah.hide();ai.show();ah.removeAttr("src");}});V.container.find(K.editContentCloseInfoMessage).on("click",function(){V.container.find(K.editContentInfoMessageBox).hide();});V.container.find(K.destroyDraftVersionLink).on("click",function(){var ah=V.container.find(K.contentId).val(),ai=V.container.find(K.contentVersion).val();g.destroyDraftVersion(ah,ai,false,V.container,function(al,aj){V.close();var ak=function(){D(Z,aj);};O.openEditServerControlWidgetDialog(al,Z,S,ak);});});var ac=V.container.find(K.widgetPreviewImage),Y=V.container.find(K.widgetNoImagePreview);if(ac.attr("src")){Y.hide();ac.show();}return aa;}O.editWidget=function(U,V,S,T){if(V===Q.serverWidget){O.openEditServerControlWidgetDialog(U,S,T);}else{if(V===Q.htmlWidget){O.openEditHtmlContentWidgetDialog(U,S,T);}else{throw new Error(a.format('A widget type "{0}" is unknown and edit action is imposible.',V));}}};O.deleteWidget=function(Y,aa,Z,T,U,W){var X=a.format(x.deleteWidgetUrl,Y,aa),S=a.format(o.deleteWidgetConfirmMessage,Z),V=function(ab){if(ab.Success&&a.isFunction(U)){U(ab);}else{if(!ab.Success&&a.isFunction(W)){W(ab);}}};z.confirm({content:S,onAccept:function(){T();a.ajax({type:"POST",url:X,contentType:"application/json; charset=utf-8",dataType:"json",cache:false}).done(function(ab){V(ab);}).fail(function(ab){V(c.parseFailedResponse(ab));});}});};O.configureWidget=function(S,T,V){var U;V=a.extend({title:o.editPageWidgetOptionsTitle,url:a.format(x.loadPageContentOptionsDialogUrl,S),disableAccept:false,cancelTitle:"",onCloseClick:null,optionListViewModel:null,editorType:""},V);z.open({title:V.title,disableAccept:V.disableAccept,cancelTitle:V.cancelTitle,onLoad:function(W){var X=V.url;k.bindDialog(W,X,{contentAvailable:function(Z,Y){var ab=Z.container.find(K.pageContentOptionsForm);var aa={showLanguages:V.editorType=="widget"&&Y.Data.ShowLanguages,translationsEnabled:Y.Data.ShowLanguages,languages:Y.Data.Languages,editorType:V.editorType};U=V.optionListViewModel||E.createOptionValuesViewModel(ab,Y.Data.OptionValues,Y.Data.CustomOptions,aa);v.applyBindings(U,ab.get(0));},beforePost:function(){return U.isValid(true);},postSuccess:function(Y){if(a.isFunction(T)){T(Y);}}});},onCloseClick:function(){if(V.onCloseClick&&a.isFunction(V.onCloseClick)){return V.onCloseClick(U);}return true;}});};O.loadSiteSettingsWidgetList=function(){k.bindSiteSettings(M,x.loadSiteSettingsWidgetListUrl,{contentAvailable:u});};function u(V){var T=M.getModalDialog(),S=T.container,W=function(X){if(X.Success&&X.Data!=null){var Z=a(K.widgetRowTemplate),Y=a(Z.html()).find(K.widgetRowTemplateFirstRow);L(Y,X);y.refreshBox(S,X);Y.insertBefore(a(K.widgetsTableFirstRow,S));t(Y);p.showHideEmptyRow(S);}};var U=T.container.find(K.siteSettingsWidgetsListForm);p.bindGridForm(U,function(X){M.setContent(X);u(X);});U.on("submit",function(X){X.preventDefault();I(U);return false;});U.find(K.widgetsSearchButton).on("click",function(){var X=a(this).parent();if(!X.hasClass("bcms-active-search")){U.find(K.widgetsSearchField).prop("disabled",false);X.addClass("bcms-active-search");U.find(K.widgetsSearchField).focus();}else{U.find(K.widgetsSearchField).prop("disabled",true);X.removeClass("bcms-active-search");U.find(K.widgetsSearchField).val("");}});if(V===true){U.find(K.widgetsSearchButton).parent().addClass("bcms-active-search");}else{U.find(K.widgetsSearchField).prop("disabled",true);}U.find(K.siteSettingsButtonOpener).on("click",function(X){c.stopEventPropagation(X);var Y=U.find(K.siteSettingsButtonHolder);if(!Y.hasClass("bcms-opened")){Y.addClass("bcms-opened");}else{Y.removeClass("bcms-opened");}});c.on(c.events.bodyClick,function(X){var Y=U.find(K.siteSettingsButtonHolder);if(Y.hasClass("bcms-opened")){Y.removeClass("bcms-opened");}});S.find(K.widgetCreateButton).on("click",function(){O.openCreateHtmlContentWidgetDialog(W,null);});S.find(K.widgetRegisterButton).on("click",function(){O.openCreateServerControlWidgetDialog(W);});t(S);p.focusSearchInput(T.container.find(K.widgetsSearchField),true);}function I(S){p.submitGridForm(S,function(T){M.setContent(T);u(true);});}function t(S){S.find(K.widgetRowCells).on("click",function(){var T=a(this).parents(K.widgetParentRow).find(K.widgetRowEditButton);l(S,T);});S.find(K.widgetRowHistoryButton).on("click",function(U){c.stopEventPropagation(U);var V=a(this);var T=V.parents(K.widgetParentRow).data("id");g.openPageContentHistoryDialog(T,null);});S.find(K.widgetsRowDeleteButtons).on("click",function(T){c.stopEventPropagation(T);j(S,a(this));});S.find(K.widgetRowUsageLinks).on("click",function(T){c.stopEventPropagation(T);m(a(this));});}function m(S){var U=S.parents(K.widgetParentRow).data("originalId"),T=a.format(x.getWidgetUsagesUrl,U);z.open({title:o.widgetUsagesDialogTitle,disableAccept:true,onLoad:function(V){k.setContentFromUrl(V,T,{done:function(Y){var X=(Y.Success==true)?Y.Data:null,Z={createItem:function(ac,ab){var ad=new w.ItemViewModel(ac,ab);ad.title=v.observable(ab.Title);ad.url=v.observable(ab.Url);ad.typeTitle=v.observable();ad.type=v.observable(ab.Type);if(ab.Type==R.page){ad.typeTitle(o.widgetUsagesType_Page);}else{if(ab.Type==R.masterPage){ad.typeTitle(o.widgetUsagesType_MasterPage);}else{if(ab.Type==R.htmlWidget){ad.typeTitle(o.widgetUsagesType_HtmlWidget);ad.deletingIsDisabled=true;}}}ad.editItem=function(){if(this.type()==R.page||this.type()==R.masterPage){F.openEditPageDialog(this.id(),function(ae){ad.url(ae.Data.PageUrl);ad.title(b.encodeHtml(ae.Data.Title));});}else{if(ab.Type==R.htmlWidget){O.openEditHtmlContentWidgetDialog(this.id(),function(ae){ad.title(ae.Data.WidgetName);});}}};ad.openItem=function(){if(this.url()){window.open(this.url());}else{this.editItem();}};return ad;}},W=V.container.find(K.widgetUsagesGrid),aa=new w.ListViewModel(W,T,X.Items,X.GridOptions,Z);v.applyBindings(aa,W.get(0));}});}});}function l(S,V){var U=V.parents(K.widgetParentRow),T=U.data("id"),W=U.data("type");O.editWidget(T,W,function(X){if(X.Data!=null){L(U,X);p.showHideEmptyRow(S);}},null);}function j(S,X){var W=X.parents(K.widgetParentRow),Y=W.data("originalId"),aa=W.data("originalVersion"),Z=W.find(K.widgetNameCell).html(),U=W.find(K.widgetsRowDeleteMessage),T=W.find(K.widgetsRowDeleteElementsToHide),V=function(ab){U.html("");U.hide();T.show();y.refreshBox(W,ab);};O.deleteWidget(Y,aa,Z,function(){T.hide();U.show();U.html(o.deletingMessage);},function(ab){V(ab);if(ab.Success){W.remove();p.showHideEmptyRow(S);}},V);}function L(T,S){T.data("id",S.Data.Id);T.data("originalId",S.Data.OriginalId);T.data("version",S.Data.Version);T.data("originalVersion",S.Data.OriginalVersion);T.find(K.widgetNameCell).html(b.encodeHtml(S.Data.WidgetName));T.find(K.widgetCategoryNameCell).html(b.encodeHtml(S.Data.CategoryName));if(S.Data.WidgetType){T.data("type",S.Data.WidgetType);}var U="";var V=a("<div></div>");if(S.Data.IsPublished&&S.Data.HasDraft){V.addClass(e.draftPublStatus);U=o.widgetStatusPublishedWithDraft;}else{if(S.Data.IsPublished){V.addClass(e.publishStatus);U=o.widgetStatusPublished;}else{if(S.Data.HasDraft){V.addClass(e.draftStatus);U=o.widgetStatusDraft;}}}V.html(U);V.attr("title",U);T.find(K.widgetStatusCell).html(V);}function A(T){var S=T.contentId,W=T.pageContentId,U,V=function(X){var Y=X!=null?X.Data:null;if(Y&&Y.DesirableStatus===c.contentStatus.preview){try{G.previewPageContent(c.pageId,Y.PreviewOnPageContentId);}finally{return false;}}else{if(a.isFunction(U)){if(X){X.Data.ContentType=P[X.Data.WidgetType];}U(X);}else{H.ReloadWithAlert();}}return true;};if(T.contentType==h.serverWidget){T.onEditContent=function(X){U=X;O.openEditServerControlWidgetDialog(S,V,W);};T.onConfigureContent=function(X){O.configureWidget(W,function(Y){if(a.isFunction(X)){X(Y);}else{H.ReloadWithAlert();}});};if(!J.IsAuthorized(["BcmsAdministration"])){T.visibleButtons.history=false;T.visibleButtons.edit=false;}if(!J.IsAuthorized(["BcmsEditContent"])){T.visibleButtons.configure=false;T.visibleButtons["delete"]=false;}}else{if(T.contentType==h.htmlWidget){T.onEditContent=function(Y,X){U=Y;O.openEditHtmlContentWidgetDialog(S,V,W,null,X);};T.onConfigureContent=function(X){O.configureWidget(W,function(Y){if(a.isFunction(X)){X(Y);}else{H.ReloadWithAlert();}});};if(!J.IsAuthorized(["BcmsAdministration"])){T.visibleButtons.history=false;T.visibleButtons.edit=false;}if(!J.IsAuthorized(["BcmsEditContent"])){T.visibleButtons.configure=false;T.visibleButtons["delete"]=false;}}}}function D(T,S){if(a.isFunction(T)){T(S);}}function B(U){var S=U.assignmentId,Y=U.widgetId,T=U.contentId,W=U.onCloseClick,X=U.optionListViewModel,V=U.editorType;if(!S&&!Y){c.logger.error("Cannot open child widget options modal window. assignmentId or widgetId should be set.");return;}O.configureWidget("",function(){},{title:o.editChildWidgetOptionsTitle,url:a.format(x.loadChildContentOptionsDialogUrl,T,S,Y,!X),disableAccept:true,cancelTitle:o.editChildWidgetOptionsCloseButtonTitle,onCloseClick:W,optionListViewModel:X,editorType:V});}function C(T){var S=T.contentId,V=a.format(x.getContentTypeUrl,S),U=function(W){if(W.Success&&W.Data&&W.Data.Id&&W.Data.Type){O.editWidget(W.Data.Id,W.Data.Type);}else{c.logger.error("Failed to load child widget type.");}};a.ajax({type:"GET",url:V,cache:false}).done(function(W){U(W);}).fail(function(W){U(c.parseFailedResponse(W));});}O.serializeFormWithChildWidgetOptions=function(U,V,ab,aa){var ac=n.serializeToObject(U,true),T=V!=null?q.getChildWidgetOptions(V):null,S=[],W,X,Z,Y;for(W in ac){if(a.isArray(ac[W])&&ac[W].length==2){Z=true;for(X=0;X<2;X++){if(ac[W][X]!=="true"&&ac[W][X]!=="false"){Z=false;continue;}}if(Z){ac[W]=ac[W][0];}}}if(ab!=null&&ab.serializeToObject!=null){ac.Options=ab.serializeToObject();}if(T){for(W in T){S.push({OptionValuesContainerId:W,OptionValues:T[W].toJson()});}}if(a.isFunction(aa)){aa(ac,S);}Y={content:ac,childContentOptionValues:S};return JSON.stringify(Y);};O.init=function(){c.logger.debug("Initializing bcms.pages.widgets module.");};c.on(c.events.contentModelCreated,A);c.on(q.events.editChildWidgetOptions,B);c.on(q.events.editWidget,C);c.registerInit(O.init);return O;});bettercms.define("bcms.pages.filter",["bcms.jquery","bcms","bcms.ko.extenders","bcms.tags","bcms.categories"],function(a,b,g,k,c){var d={},i={filterTemplate:"#bcms-filter-template",filterByLanguage:"#bcms-js-filter-languages",filterByStatus:"#bcms-js-filter-status",filterBySeoStatus:"#bcms-js-filter-seostatus",filterByLayout:"#bcms-js-filter-layout",filterSort:"#bcms-js-filter-sort",hiddenSortColumnField:"#bcms-grid-sort-column",hiddenSortDirectionField:"#bcms-grid-sort-direction",hiddenPageNumberField:"#bcms-grid-page-number",siteSettingsPagesListForm:"#bcms-pages-form"},h={},f={};d.links=h;d.globalization=f;function j(o,l,m){var n=this;n.title=o;n.column=l;n.direction=m;return n;}function e(q,l,m,o,n){var p=this;p.isVisible=g.observable(false);p.tags=q;p.categories=l;p.includeArchived=g.observable(false);p.includeMasterPages=g.observable(false);p.languageId=g.observable(n.LanguageId);p.languages=n.Languages||[];p.status=g.observable(n.Status);p.statuses=n.Statuses||[];p.seoStatus=g.observable(n.SeoStatus);p.seoStatuses=n.SeoStatuses||[];p.layout=g.observable(n.Layout);p.layouts=n.Layouts||[];p.languages.unshift({Key:"",Value:""});p.statuses.unshift({Key:"",Value:""});p.seoStatuses.unshift({Key:"",Value:""});p.layouts.unshift({Key:"",Value:""});p.showSorting=g.observable(false);p.sortColumn=g.observable(n.GridOptions.Column);p.sortDirection=g.observable(n.GridOptions.Direction);p.sortFields=g.observableArray([]);p.suspendSortingSelector=false;if(n.SortAliases){n.SortAliases.forEach(function(r){p.sortFields.push(new j(r.Title,r.Column,r.Direction));});}p.isEdited=g.computed(function(){if(p.includeArchived()){return true;}if(p.includeMasterPages()){return true;}if(p.tags!=null&&p.tags.items()!=null&&p.tags.items().length>0){return true;}if(p.categories!=null&&p.categories.items()!=null&&p.categories.items().length>0){return true;}if(p.languageId()||p.seoStatus()||p.status()||p.layout()){return true;}return false;});p.form=m.find(i.siteSettingsPagesListForm);p.toggleShowSorting=function(){p.showSorting(!p.showSorting());p.suspendSortingSelector=true;setTimeout(function(){p.suspendSortingSelector=false;},100);};p.applySort=function(s,r,t){p.sortColumn(r);p.sortDirection(t);p.showSorting(false);p.form.find(i.hiddenSortColumnField).val(r);p.form.find(i.hiddenSortDirectionField).val(t);o(true);};p.toggleFilter=function(){p.isVisible(!p.isVisible());};p.closeFilter=function(){p.isVisible(false);};p.searchWithFilter=function(){if(a.isFunction(o)){o();}};p.clearFilter=function(){p.tags.items([]);p.categories.items([]);p.includeArchived(false);p.includeMasterPages(false);p.languageId("");p.status("");p.seoStatus("");p.layout("");p.searchWithFilter();};p.changeIncludeArchived=function(){p.includeArchived(!(p.includeArchived()));};p.changeIncludeMasterPages=function(){p.includeMasterPages(!(p.includeMasterPages()));};b.on(b.events.bodyClick,function(r){if(!p.suspendSortingSelector){if(p.showSorting()==true){p.showSorting(false);}}});}d.bind=function(m,o,p){var q=new k.TagsListViewModel(o.Tags),l=new c.CategoriesSelectListModel(o.Categories),n=new e(q,l,m,p,o);c.initCategoriesSelect(l,o.CategoriesLookupList);n.includeArchived(o.IncludeArchived?true:false);n.includeMasterPages(o.IncludeMasterPages?true:false);g.applyBindings(n,m.find(i.filterTemplate).get(0));};d.init=function(){b.logger.debug("Initializing bcms.pages.filter module.");};b.registerInit(d.init);return d;});